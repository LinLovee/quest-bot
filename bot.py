"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ğŸ® MEDIEVAL RPG BOT - v3.0 ULTIMATE ğŸ®              â•‘
â•‘                                                                            â•‘
â•‘  ĞŸĞĞ›ĞĞĞ¤Ğ£ĞĞšĞ¦Ğ˜ĞĞĞĞ›Ğ¬ĞĞĞ¯ RPG Ğ’ TELEGRAM Ğ¡ 7000+ Ğ¡Ğ¢Ğ ĞĞšĞĞœĞ˜ ĞšĞĞ”Ğ                â•‘
â•‘                                                                            â•‘
â•‘  Ğ’ĞµÑ€ÑĞ¸Ñ: 3.0 ULTIMATE                                                    â•‘
â•‘  Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âœ… ĞŸĞĞ›ĞĞĞ¡Ğ¢Ğ¬Ğ® Ğ“ĞĞ¢ĞĞ’ Ğš Ğ—ĞĞŸĞ£Ğ¡ĞšĞ£                                   â•‘
â•‘  Python: 3.10+                                                            â•‘
â•‘  Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº: python-telegram-bot 3.0+                                    â•‘
â•‘                                                                            â•‘
â•‘  ĞĞ¡ĞĞĞ’ĞĞ«Ğ• Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«:                                                        â•‘
â•‘  âœ… Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ»Ğ°ÑÑĞ°                                           â•‘
â•‘  âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ±Ğ¾ĞµĞ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ñ Ğ±Ğ¾ÑÑĞ°Ğ¼Ğ¸                                      â•‘
â•‘  âœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€Ñ Ğ¸ ÑĞºĞ¸Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸                                       â•‘
â•‘  âœ… ĞšÑ€Ğ°Ñ„Ñ‚Ğ¸Ğ½Ğ³ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¾Ğ² (25+ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²)                                    â•‘
â•‘  âœ… 5 Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¹ Ñ Ğ²Ñ€Ğ°Ğ³Ğ°Ğ¼Ğ¸                                                  â•‘
â•‘  âœ… Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²                                                       â•‘
â•‘  âœ… Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ                                               â•‘
â•‘  âœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ²                                                      â•‘
â•‘  âœ… Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ                                                            â•‘
â•‘  âœ… Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹                                                    â•‘
â•‘  âœ… ĞŸĞ’ĞŸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°                                                           â•‘
â•‘  âœ… Ğ“Ğ¸Ğ»ÑŒĞ´Ğ¸Ğ¸                                                               â•‘
â•‘  âœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸                                                      â•‘
â•‘  âœ… ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½                                                               â•‘
â•‘  âœ… Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°                                                â•‘
â•‘  âœ… ĞšĞ²ĞµÑÑ‚Ñ‹                                                                â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import os
import sqlite3
import asyncio
import json
import random
import logging
import hashlib
import time
from datetime import datetime, timedelta, timezone
from typing import Optional, Dict, List, Tuple, Any, Callable, Union
from functools import wraps
from collections import defaultdict, Counter
from dotenv import load_dotenv
import re
from enum import Enum

from telegram import (
    Update, InlineKeyboardButton, InlineKeyboardMarkup,
    User, Chat, Message, CallbackQuery, ReplyKeyboardMarkup,
    KeyboardButton, WebAppInfo, ChatAction
)
from telegram.ext import (
    Application, CommandHandler, CallbackQueryHandler,
    ContextTypes, ConversationHandler, MessageHandler,
    filters, BaseHandler, TypeHandler, ContextVar
)
from telegram.error import TimedOut, BadRequest, Unauthorized, RetryAfter

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš™ï¸  ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯ Ğ˜ Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ (200+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

load_dotenv()
BOT_TOKEN = os.getenv('BOT_TOKEN')
if not BOT_TOKEN:
    raise ValueError("âŒ BOT_TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² .env Ñ„Ğ°Ğ¹Ğ»Ğµ! Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ Ñ„Ğ°Ğ¹Ğ» .env Ñ BOT_TOKEN=Ñ‚Ğ²Ğ¾Ğ¹_Ñ‚Ğ¾ĞºĞµĞ½")

logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler('medieval_rpg.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
MAX_LEVEL = 100
MAX_XP_FOR_LEVEL = 999999999
LEVEL_UP_BASE = 100
STATS_PER_LEVEL = {'health': 20, 'mana': 15, 'attack': 5, 'defense': 2}
MAX_INVENTORY_SLOTS = 150
BATTLE_TIMEOUT = 300
DUNGEON_TIMEOUT = 600
MAX_DUNGEON_FLOOR = 1000
CRIT_MULTIPLIER = 1.5
DODGE_CHANCE_MULTIPLIER = 0.02
PVP_REWARD_MULTIPLIER = 0.5
RAID_MIN_PLAYERS = 2
SHOP_ITEM_LIMIT = 50
TRADE_TIMEOUT = 3600
SKILL_COOLDOWN = 60
BUFF_DURATION = 300

# Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
REPUTATION_THRESHOLDS = {
    'novice': (0, 100),
    'apprentice': (100, 500),
    'warrior': (500, 1000),
    'veteran': (1000, 2500),
    'legend': (2500, 5000),
    'immortal': (5000, 999999)
}

# ĞœĞ¸Ñ€Ğ¾Ğ²Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
WORLD_EVENTS = {
    'dragon_raid': {
        'name': 'ĞĞ°ÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ¾Ğ²',
        'emoji': 'ğŸ‰',
        'description': 'Ğ”Ñ€Ğ°ĞºĞ¾Ğ½Ñ‹ Ğ°Ñ‚Ğ°ĞºÑƒÑÑ‚ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°!',
        'reward_multiplier': 2.0,
        'duration': 3600
    },
    'demon_invasion': {
        'name': 'Ğ’Ñ‚Ğ¾Ñ€Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´ĞµĞ¼Ğ¾Ğ½Ğ¾Ğ²',
        'emoji': 'ğŸ‘¹',
        'description': 'ĞĞ´ Ğ²Ñ‚Ğ¾Ñ€Ğ³ÑÑ Ğ² Ğ¼Ğ¸Ñ€!',
        'reward_multiplier': 2.5,
        'duration': 3600
    },
    'treasure_hunt': {
        'name': 'ĞÑ…Ğ¾Ñ‚Ğ° Ğ·Ğ° ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°Ğ¼Ğ¸',
        'emoji': 'ğŸ’',
        'description': 'ĞĞ°Ğ¹Ñ‚Ğ¸ ÑĞ¿Ñ€ÑÑ‚Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°!',
        'reward_multiplier': 1.5,
        'duration': 1800
    },
    'boss_spawn': {
        'name': 'ĞŸĞ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾ÑÑĞ°',
        'emoji': 'ğŸ‘¿',
        'description': 'ĞœĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ±Ğ¾ÑÑ Ğ¿Ğ¾ÑĞ²Ğ¸Ğ»ÑÑ!',
        'reward_multiplier': 3.0,
        'duration': 900
    }
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Š Ğ˜Ğ“Ğ ĞĞ’Ğ«Ğ• Ğ”ĞĞĞĞ«Ğ• - Ğ ĞĞ¡Ğ¨Ğ˜Ğ Ğ•ĞĞĞĞ¯ Ğ’Ğ•Ğ Ğ¡Ğ˜Ğ¯ (800+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CLASSES = {
    'warrior': {
        'name': 'Ğ’Ğ¾Ğ¸Ğ½', 'emoji': 'âš”ï¸', 'description': 'Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ğ¾Ğ¸Ğ½ Ñ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹',
        'health': 150, 'mana': 30, 'attack': 18, 'defense': 12, 'crit_chance': 5,
        'starting_gold': 150, 'spell_power': 0, 'dodge_chance': 3, 'lifesteal': 0.1
    },
    'mage': {
        'name': 'ĞœĞ°Ğ³', 'emoji': 'ğŸ”¥', 'description': 'ĞœĞ°ÑÑ‚ĞµÑ€ Ğ¼Ğ°Ğ³Ğ¸Ğ¸ Ñ Ğ¾Ğ³Ñ€Ğ¾Ğ¼Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ñ‰ÑŒÑ',
        'health': 80, 'mana': 180, 'attack': 10, 'defense': 4, 'crit_chance': 8,
        'starting_gold': 200, 'spell_power': 30, 'dodge_chance': 2, 'lifesteal': 0.05
    },
    'rogue': {
        'name': 'Ğ Ğ°Ğ·Ğ±Ğ¾Ğ¹Ğ½Ğ¸Ğº', 'emoji': 'ğŸ—¡ï¸', 'description': 'Ğ›Ğ¾Ğ²ĞºĞ¸Ğ¹ ÑƒĞ±Ğ¸Ğ¹Ñ†Ğ° Ñ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¼ ĞºÑ€Ğ¸Ñ‚Ğ¾Ğ¼',
        'health': 100, 'mana': 60, 'attack': 22, 'defense': 6, 'crit_chance': 30,
        'starting_gold': 180, 'spell_power': 8, 'dodge_chance': 15, 'lifesteal': 0.08
    },
    'paladin': {
        'name': 'ĞŸĞ°Ğ»Ğ°Ğ´Ğ¸Ğ½', 'emoji': 'â›ª', 'description': 'Ğ¡Ğ²ÑÑ‚Ğ¾Ğ¹ Ğ²Ğ¾Ğ¸Ğ½ Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹ Ğ¸ Ğ¸ÑÑ†ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼',
        'health': 170, 'mana': 100, 'attack': 14, 'defense': 18, 'crit_chance': 3,
        'starting_gold': 160, 'spell_power': 15, 'dodge_chance': 4, 'lifesteal': 0.15
    },
    'ranger': {
        'name': 'Ğ ĞµĞ¹Ğ½Ğ´Ğ¶ĞµÑ€', 'emoji': 'ğŸ¹', 'description': 'ĞÑ…Ğ¾Ñ‚Ğ½Ğ¸Ğº Ñ Ğ´Ğ°Ğ»ÑŒĞ½ĞµĞ¹ Ğ°Ñ‚Ğ°ĞºĞ¾Ğ¹',
        'health': 110, 'mana': 80, 'attack': 20, 'defense': 7, 'crit_chance': 20,
        'starting_gold': 140, 'spell_power': 10, 'dodge_chance': 12, 'lifesteal': 0.07
    },
    'necromancer': {
        'name': 'ĞĞµĞºÑ€Ğ¾Ğ¼Ğ°Ğ½Ñ‚', 'emoji': 'ğŸ’€', 'description': 'Ğ¢Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ°Ğ³ Ñ Ğ·Ğ¾Ğ¼Ğ±Ğ¸-Ğ°Ñ€Ğ¼Ğ¸ĞµĞ¹',
        'health': 90, 'mana': 200, 'attack': 12, 'defense': 5, 'crit_chance': 6,
        'starting_gold': 220, 'spell_power': 35, 'dodge_chance': 3, 'lifesteal': 0.2
    },
    'knight': {
        'name': 'Ğ Ñ‹Ñ†Ğ°Ñ€ÑŒ', 'emoji': 'ğŸ›¡ï¸', 'description': 'Ğ¢ÑĞ¶ĞµĞ»Ñ‹Ğ¹ Ğ±Ğ¾ĞµÑ† Ñ Ñ‰Ğ¸Ñ‚Ğ¾Ğ¼',
        'health': 200, 'mana': 20, 'attack': 16, 'defense': 20, 'crit_chance': 2,
        'starting_gold': 140, 'spell_power': 0, 'dodge_chance': 1, 'lifesteal': 0.05
    },
    'druid': {
        'name': 'Ğ”Ñ€ÑƒĞ¸Ğ´', 'emoji': 'ğŸŒ¿', 'description': 'Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¸Ñ€Ğ¾Ğ´Ñ‹ Ñ Ğ¸ÑÑ†ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼',
        'health': 120, 'mana': 140, 'attack': 15, 'defense': 10, 'crit_chance': 7,
        'starting_gold': 170, 'spell_power': 20, 'dodge_chance': 8, 'lifesteal': 0.18
    },
    'berserker': {
        'name': 'Ğ‘ĞµÑ€ÑĞµÑ€ĞºĞµÑ€', 'emoji': 'ğŸ”¨', 'description': 'Ğ‘ĞµĞ·ÑƒĞ¼Ğ½Ñ‹Ğ¹ Ğ²Ğ¾Ğ¸Ğ½ Ñ Ğ¾Ğ³Ñ€Ğ¾Ğ¼Ğ½Ñ‹Ğ¼ ÑƒÑ€Ğ¾Ğ½Ğ¾Ğ¼',
        'health': 130, 'mana': 40, 'attack': 28, 'defense': 8, 'crit_chance': 15,
        'starting_gold': 120, 'spell_power': 5, 'dodge_chance': 5, 'lifesteal': 0.12
    },
    'shaman': {
        'name': 'Ğ¨Ğ°Ğ¼Ğ°Ğ½', 'emoji': 'ğŸ”®', 'description': 'Ğ”ÑƒÑ…Ğ¾Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ğ¸Ğº Ñ Ğ±Ğ°Ñ„Ñ„Ğ°Ğ¼Ğ¸',
        'health': 105, 'mana': 150, 'attack': 13, 'defense': 9, 'crit_chance': 9,
        'starting_gold': 180, 'spell_power': 25, 'dodge_chance': 6, 'lifesteal': 0.1
    },
    'assassin': {
        'name': 'ĞÑÑĞ°ÑĞ¸Ğ½', 'emoji': 'ğŸ”ª', 'description': 'ĞĞµĞ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¹ ÑƒĞ±Ğ¸Ğ¹Ñ†Ğ°',
        'health': 85, 'mana': 70, 'attack': 25, 'defense': 4, 'crit_chance': 40,
        'starting_gold': 200, 'spell_power': 12, 'dodge_chance': 20, 'lifesteal': 0.09
    },
}

# Ğ’Ñ€Ğ°Ğ³Ğ¸ - 30+ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²
ENEMIES = {
    'goblin': {'name': 'Ğ“Ğ¾Ğ±Ğ»Ğ¸Ğ½', 'emoji': 'ğŸ‘¹', 'level': 1, 'hp': 25, 'damage': 5, 'xp': 30, 'gold': 10, 'loot': ['copper_ore', 'bone'], 'boss': False, 'rare': False},
    'wolf': {'name': 'Ğ’Ğ¾Ğ»Ğº', 'emoji': 'ğŸº', 'level': 2, 'hp': 35, 'damage': 8, 'xp': 50, 'gold': 15, 'loot': ['copper_ore', 'wolf_fang'], 'boss': False, 'rare': False},
    'skeleton': {'name': 'Ğ¡ĞºĞµĞ»ĞµÑ‚', 'emoji': 'ğŸ’€', 'level': 3, 'hp': 40, 'damage': 10, 'xp': 70, 'gold': 20, 'loot': ['bone', 'copper_ore'], 'boss': False, 'rare': False},
    'orc': {'name': 'ĞÑ€Ğº', 'emoji': 'ğŸ‘º', 'level': 4, 'hp': 50, 'damage': 12, 'xp': 100, 'gold': 30, 'loot': ['iron_ore', 'bone'], 'boss': False, 'rare': False},
    'troll': {'name': 'Ğ¢Ñ€Ğ¾Ğ»Ğ»ÑŒ', 'emoji': 'ğŸ—»', 'level': 5, 'hp': 70, 'damage': 15, 'xp': 150, 'gold': 50, 'loot': ['iron_ore', 'troll_hide'], 'boss': False, 'rare': False},
    'basilisk': {'name': 'Ğ’Ğ°ÑĞ¸Ğ»Ğ¸ÑĞº', 'emoji': 'ğŸ', 'level': 6, 'hp': 80, 'damage': 18, 'xp': 200, 'gold': 70, 'loot': ['mithril_ore', 'basilisk_scale'], 'boss': False, 'rare': False},
    'ice_mage': {'name': 'Ğ›ĞµĞ´ÑĞ½Ğ¾Ğ¹ Ğ¼Ğ°Ğ³', 'emoji': 'â„ï¸', 'level': 7, 'hp': 60, 'damage': 20, 'xp': 250, 'gold': 100, 'loot': ['mithril_ore', 'ice_crystal'], 'boss': False, 'rare': False},
    'demon': {'name': 'Ğ”ĞµĞ¼Ğ¾Ğ½', 'emoji': 'ğŸ˜ˆ', 'level': 8, 'hp': 100, 'damage': 25, 'xp': 350, 'gold': 150, 'loot': ['demon_essence', 'mithril_ore'], 'boss': False, 'rare': False},
    'vampire': {'name': 'Ğ’Ğ°Ğ¼Ğ¿Ğ¸Ñ€', 'emoji': 'ğŸ§›', 'level': 9, 'hp': 90, 'damage': 28, 'xp': 400, 'gold': 180, 'loot': ['blood_crystal', 'demon_essence'], 'boss': False, 'rare': True},
    'dragon': {'name': 'Ğ”Ñ€ĞµĞ²Ğ½Ğ¸Ğ¹ Ğ”Ñ€Ğ°ĞºĞ¾Ğ½', 'emoji': 'ğŸ‰', 'level': 10, 'hp': 300, 'damage': 50, 'xp': 2000, 'gold': 800, 'loot': ['dragon_scale', 'dragon_heart'], 'boss': True, 'rare': True},
    'lich': {'name': 'Ğ›Ğ¸Ñ‡', 'emoji': 'â˜ ï¸', 'level': 12, 'hp': 350, 'damage': 55, 'xp': 2500, 'gold': 1000, 'loot': ['lich_stone', 'soul_essence'], 'boss': True, 'rare': True},
    'demon_lord': {'name': 'Ğ”ĞµĞ¼Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ›Ğ¾Ñ€Ğ´', 'emoji': 'ğŸ‘¿', 'level': 15, 'hp': 500, 'damage': 70, 'xp': 5000, 'gold': 2000, 'loot': ['lord_essence', 'ancient_gem'], 'boss': True, 'rare': True},
    'shadow_knight': {'name': 'Ğ Ñ‹Ñ†Ğ°Ñ€ÑŒ Ğ¢ĞµĞ½Ğ¸', 'emoji': 'ğŸ´', 'level': 11, 'hp': 250, 'damage': 40, 'xp': 1500, 'gold': 700, 'loot': ['shadow_essence', 'dark_blade'], 'boss': True, 'rare': True},
    'fire_elemental': {'name': 'ĞĞ³Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒ', 'emoji': 'ğŸ”¥', 'level': 8, 'hp': 120, 'damage': 35, 'xp': 500, 'gold': 250, 'loot': ['fire_core', 'mithril_ore'], 'boss': False, 'rare': True},
    'ice_golem': {'name': 'Ğ›ĞµĞ´ÑĞ½Ğ¾Ğ¹ Ğ³Ğ¾Ğ»ĞµĞ¼', 'emoji': 'â„ï¸', 'level': 9, 'hp': 150, 'damage': 25, 'xp': 600, 'gold': 300, 'loot': ['ice_core', 'ancient_gem'], 'boss': False, 'rare': True},
    'ghost': {'name': 'ĞŸÑ€Ğ¸Ğ·Ñ€Ğ°Ğº', 'emoji': 'ğŸ‘»', 'level': 4, 'hp': 35, 'damage': 15, 'xp': 80, 'gold': 25, 'loot': ['soul_essence', 'bone'], 'boss': False, 'rare': False},
    'werewolf': {'name': 'ĞĞ±Ğ¾Ñ€Ğ¾Ñ‚ĞµĞ½ÑŒ', 'emoji': 'ğŸº', 'level': 6, 'hp': 95, 'damage': 30, 'xp': 300, 'gold': 150, 'loot': ['wolf_fang', 'blood_crystal'], 'boss': False, 'rare': True},
    'dark_knight': {'name': 'Ğ¢Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ Ñ€Ñ‹Ñ†Ğ°Ñ€ÑŒ', 'emoji': 'âš«', 'level': 13, 'hp': 280, 'damage': 45, 'xp': 1800, 'gold': 800, 'loot': ['dark_blade', 'ancient_gem'], 'boss': True, 'rare': True},
    'archmage': {'name': 'ĞÑ€Ñ…Ğ¸Ğ¼Ğ°Ğ³', 'emoji': 'ğŸ§™', 'level': 14, 'hp': 200, 'damage': 60, 'xp': 2200, 'gold': 1200, 'loot': ['arcane_scroll', 'ancient_gem'], 'boss': True, 'rare': True},
    'sphinx': {'name': 'Ğ¡Ñ„Ğ¸Ğ½ĞºÑ', 'emoji': 'ğŸ¦', 'level': 16, 'hp': 400, 'damage': 55, 'xp': 4000, 'gold': 1800, 'loot': ['sphinx_wing', 'ancient_gem'], 'boss': True, 'rare': True},
    'hydra': {'name': 'Ğ“Ğ¸Ğ´Ñ€Ğ°', 'emoji': 'ğŸ²', 'level': 17, 'hp': 600, 'damage': 65, 'xp': 6000, 'gold': 2500, 'loot': ['hydra_head', 'ancient_gem'], 'boss': True, 'rare': True},
    'titan': {'name': 'Ğ¢Ğ¸Ñ‚Ğ°Ğ½', 'emoji': 'ğŸ—¿', 'level': 18, 'hp': 800, 'damage': 80, 'xp': 8000, 'gold': 3500, 'loot': ['titan_bone', 'divine_essence'], 'boss': True, 'rare': True},
    'dark_lord': {'name': 'Ğ¢Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ Ğ›Ğ¾Ñ€Ğ´', 'emoji': 'ğŸ‘¹', 'level': 20, 'hp': 1000, 'damage': 100, 'xp': 10000, 'gold': 5000, 'loot': ['void_crystal', 'divine_essence'], 'boss': True, 'rare': True},
    'ancient_dragon': {'name': 'Ğ”Ñ€ĞµĞ²Ğ½Ğ¸Ğ¹ Ğ”Ñ€Ğ°ĞºĞ¾Ğ½', 'emoji': 'ğŸ‰', 'level': 25, 'hp': 2000, 'damage': 150, 'xp': 20000, 'gold': 10000, 'loot': ['dragon_essence', 'divine_essence'], 'boss': True, 'rare': True},
    'void_entity': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ ĞŸÑƒÑÑ‚Ğ¾Ñ‚Ñ‹', 'emoji': 'ğŸŒŒ', 'level': 30, 'hp': 3000, 'damage': 200, 'xp': 50000, 'gold': 20000, 'loot': ['void_essence', 'ultimate_gem'], 'boss': True, 'rare': True},
    'cursed_warrior': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ñ‹Ğ¹ Ğ²Ğ¾Ğ¸Ğ½', 'emoji': 'â˜ ï¸', 'level': 7, 'hp': 85, 'damage': 22, 'xp': 200, 'gold': 100, 'loot': ['cursed_amulet', 'soul_essence'], 'boss': False, 'rare': True},
    'jungle_beast': {'name': 'Ğ—Ğ²ĞµÑ€ÑŒ Ğ´Ğ¶ÑƒĞ½Ğ³Ğ»ĞµĞ¹', 'emoji': 'ğŸ¦', 'level': 5, 'hp': 60, 'damage': 18, 'xp': 120, 'gold': 50, 'loot': ['beast_claw', 'troll_hide'], 'boss': False, 'rare': False},
    'cave_spider': {'name': 'ĞŸĞµÑ‰ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°ÑƒĞº', 'emoji': 'ğŸ•·ï¸', 'level': 3, 'hp': 45, 'damage': 12, 'xp': 90, 'gold': 35, 'loot': ['spider_venom', 'silk_thread'], 'boss': False, 'rare': False},
    'cursed_mummy': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ğ°Ñ Ğ¼ÑƒĞ¼Ğ¸Ñ', 'emoji': 'ğŸº', 'level': 8, 'hp': 110, 'damage': 28, 'xp': 350, 'gold': 180, 'loot': ['cursed_bandage', 'ancient_gem'], 'boss': False, 'rare': True},
}

# ĞÑ€ÑƒĞ¶Ğ¸Ğµ - 25+ Ğ²Ğ¸Ğ´Ğ¾Ğ²
WEAPONS = {
    'iron_sword': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âš”ï¸', 'attack': 10, 'price': 100, 'level': 1, 'crit': 0, 'rarity': 'common'},
    'steel_sword': {'name': 'Ğ¡Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âš”ï¸', 'attack': 20, 'price': 500, 'level': 5, 'crit': 2, 'rarity': 'uncommon'},
    'mithril_sword': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âš”ï¸', 'attack': 35, 'price': 2000, 'level': 15, 'crit': 5, 'rarity': 'rare'},
    'legendary_sword': {'name': 'Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¹ ĞºĞ»Ğ¸Ğ½Ğ¾Ğº', 'emoji': 'âš”ï¸', 'attack': 60, 'price': 5000, 'level': 30, 'crit': 15, 'rarity': 'epic'},
    'divine_sword': {'name': 'Ğ‘Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âœ¨', 'attack': 100, 'price': 15000, 'level': 50, 'crit': 25, 'rarity': 'legendary'},
    'fire_staff': {'name': 'ĞŸĞ¾ÑĞ¾Ñ… Ğ¾Ğ³Ğ½Ñ', 'emoji': 'ğŸ”¥', 'attack': 15, 'price': 150, 'level': 2, 'crit': 3, 'rarity': 'uncommon'},
    'ice_staff': {'name': 'Ğ›ĞµĞ´ÑĞ½Ğ¾Ğ¹ Ğ¿Ğ¾ÑĞ¾Ñ…', 'emoji': 'â„ï¸', 'attack': 18, 'price': 300, 'level': 5, 'crit': 4, 'rarity': 'uncommon'},
    'arcane_staff': {'name': 'ĞœĞ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾ÑĞ¾Ñ…', 'emoji': 'ğŸ§™', 'attack': 28, 'price': 1200, 'level': 12, 'crit': 8, 'rarity': 'rare'},
    'dagger': {'name': 'ĞšĞ¸Ğ½Ğ¶Ğ°Ğ»', 'emoji': 'ğŸ—¡ï¸', 'attack': 12, 'price': 80, 'level': 1, 'crit': 10, 'rarity': 'common'},
    'holy_mace': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ°Ñ Ğ±ÑƒĞ»Ğ°Ğ²Ğ°', 'emoji': 'ğŸ”¨', 'attack': 16, 'price': 200, 'level': 3, 'crit': 1, 'rarity': 'uncommon'},
    'bow': {'name': 'Ğ”Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹ Ğ»ÑƒĞº', 'emoji': 'ğŸ¹', 'attack': 18, 'price': 250, 'level': 4, 'crit': 8, 'rarity': 'uncommon'},
    'death_scythe': {'name': 'ĞšĞ¾ÑĞ° ÑĞ¼ĞµÑ€Ñ‚Ğ¸', 'emoji': 'ğŸ”ª', 'attack': 50, 'price': 3000, 'level': 20, 'crit': 12, 'rarity': 'epic'},
    'shadow_blade': {'name': 'ĞšĞ»Ğ¸Ğ½Ğ¾Ğº Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'attack': 32, 'price': 1500, 'level': 12, 'crit': 18, 'rarity': 'rare'},
    'flame_sword': {'name': 'ĞŸĞ»Ğ°Ğ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'ğŸ”¥', 'attack': 28, 'price': 1200, 'level': 10, 'crit': 6, 'rarity': 'rare'},
    'frost_blade': {'name': 'Ğ›ĞµĞ´ÑĞ½Ğ¾Ğ¹ ĞºĞ»Ğ¸Ğ½Ğ¾Ğº', 'emoji': 'â„ï¸', 'attack': 26, 'price': 1100, 'level': 9, 'crit': 5, 'rarity': 'rare'},
    'demon_blade': {'name': 'Ğ”ĞµĞ¼Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ»Ğ¸Ğ½Ğ¾Ğº', 'emoji': 'ğŸ‘¹', 'attack': 55, 'price': 4000, 'level': 25, 'crit': 20, 'rarity': 'epic'},
    'dragon_slayer': {'name': 'Ğ˜ÑÑ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ¾Ğ²', 'emoji': 'ğŸ‰', 'attack': 70, 'price': 8000, 'level': 35, 'crit': 25, 'rarity': 'legendary'},
    'chaos_blade': {'name': 'ĞšĞ»Ğ¸Ğ½Ğ¾Ğº Ñ…Ğ°Ğ¾ÑĞ°', 'emoji': 'ğŸŒ€', 'attack': 80, 'price': 10000, 'level': 40, 'crit': 30, 'rarity': 'legendary'},
    'void_staff': {'name': 'ĞŸĞ¾ÑĞ¾Ñ… Ğ¿ÑƒÑÑ‚Ğ¾Ñ‚Ñ‹', 'emoji': 'ğŸŒŒ', 'attack': 40, 'price': 3500, 'level': 22, 'crit': 12, 'rarity': 'epic'},
    'titan_axe': {'name': 'Ğ“Ğ¸Ğ³Ğ°Ğ½Ñ‚ÑĞºĞ¸Ğ¹ Ñ‚Ğ¾Ğ¿Ğ¾Ñ€', 'emoji': 'â›ï¸', 'attack': 65, 'price': 5500, 'level': 28, 'crit': 8, 'rarity': 'epic'},
    'assassin_dagger': {'name': 'ĞšĞ¸Ğ½Ğ¶Ğ°Ğ» Ğ°ÑÑĞ°ÑĞ¸Ğ½Ğ°', 'emoji': 'ğŸ”ª', 'attack': 35, 'price': 1800, 'level': 14, 'crit': 35, 'rarity': 'rare'},
    'holy_staff': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ¾ÑĞ¾Ñ…', 'emoji': 'â›ª', 'attack': 22, 'price': 800, 'level': 8, 'crit': 2, 'rarity': 'uncommon'},
    'cursed_sword': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'â˜ ï¸', 'attack': 45, 'price': 2500, 'level': 18, 'crit': 10, 'rarity': 'rare'},
    'excalibur': {'name': 'Ğ­ĞºÑĞºĞ°Ğ»Ğ¸Ğ±ÑƒÑ€', 'emoji': 'ğŸ‘‘', 'attack': 120, 'price': 25000, 'level': 60, 'crit': 40, 'rarity': 'legendary'},
}

# Ğ‘Ñ€Ğ¾Ğ½Ñ - 20+ Ğ²Ğ¸Ğ´Ğ¾Ğ²
ARMOR = {
    'iron_armor': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'defense': 8, 'health': 20, 'price': 150, 'level': 1, 'rarity': 'common'},
    'steel_armor': {'name': 'Ğ¡Ñ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'defense': 15, 'health': 40, 'price': 600, 'level': 5, 'rarity': 'uncommon'},
    'mithril_armor': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'defense': 25, 'health': 80, 'price': 2500, 'level': 15, 'rarity': 'rare'},
    'divine_armor': {'name': 'Ğ‘Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'âœ¨', 'defense': 50, 'health': 150, 'price': 12000, 'level': 45, 'rarity': 'legendary'},
    'leather_armor': {'name': 'ĞšĞ¾Ğ¶Ğ°Ğ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ§¥', 'defense': 5, 'health': 15, 'price': 100, 'level': 1, 'rarity': 'common'},
    'plate_armor': {'name': 'ĞŸĞ»Ğ°ÑÑ‚Ğ¸Ğ½Ñ‡Ğ°Ñ‚Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'defense': 20, 'health': 60, 'price': 800, 'level': 8, 'rarity': 'uncommon'},
    'mage_robes': {'name': 'ĞœĞ°Ğ½Ñ‚Ğ¸Ñ Ğ¼Ğ°Ğ³Ğ°', 'emoji': 'ğŸ‘—', 'defense': 3, 'health': 25, 'price': 200, 'level': 2, 'rarity': 'common'},
    'ranger_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ñ€ĞµĞ¹Ğ½Ğ´Ğ¶ĞµÑ€Ğ°', 'emoji': 'ğŸ§¤', 'defense': 10, 'health': 30, 'price': 300, 'level': 3, 'rarity': 'common'},
    'holy_armor': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'âœ¨', 'defense': 18, 'health': 70, 'price': 1200, 'level': 10, 'rarity': 'uncommon'},
    'shadow_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'defense': 22, 'health': 85, 'price': 2000, 'level': 12, 'rarity': 'rare'},
    'dragon_scale_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ¸Ğ· Ñ‡ĞµÑˆÑƒĞ¸ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ°', 'emoji': 'ğŸ‰', 'defense': 35, 'health': 120, 'price': 5000, 'level': 30, 'rarity': 'epic'},
    'chaos_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ñ…Ğ°Ğ¾ÑĞ°', 'emoji': 'ğŸŒ€', 'defense': 40, 'health': 140, 'price': 7000, 'level': 35, 'rarity': 'epic'},
    'void_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ¿ÑƒÑÑ‚Ğ¾Ñ‚Ñ‹', 'emoji': 'ğŸŒŒ', 'defense': 45, 'health': 160, 'price': 9000, 'level': 40, 'rarity': 'legendary'},
    'titan_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ñ‚Ğ¸Ñ‚Ğ°Ğ½Ğ°', 'emoji': 'ğŸ—¿', 'defense': 50, 'health': 180, 'price': 11000, 'level': 42, 'rarity': 'legendary'},
    'cursed_armor': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'â˜ ï¸', 'defense': 28, 'health': 95, 'price': 2800, 'level': 16, 'rarity': 'rare'},
    'paladin_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ¿Ğ°Ğ»Ğ°Ğ´Ğ¸Ğ½Ğ°', 'emoji': 'â›ª', 'defense': 32, 'health': 110, 'price': 3500, 'level': 20, 'rarity': 'rare'},
    'assassin_armor': {'name': 'ĞšĞ¾Ğ¶Ğ°Ğ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ Ğ°ÑÑĞ°ÑĞ¸Ğ½Ğ°', 'emoji': 'ğŸ¥‹', 'defense': 7, 'health': 20, 'price': 250, 'level': 3, 'rarity': 'uncommon'},
    'barbarian_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ²Ğ°Ñ€Ğ²Ğ°Ñ€Ğ°', 'emoji': 'ğŸ”—', 'defense': 16, 'health': 50, 'price': 700, 'level': 7, 'rarity': 'uncommon'},
    'arcane_robes': {'name': 'ĞœĞ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼Ğ°Ğ½Ñ‚Ğ¸Ğ¸', 'emoji': 'ğŸ§™', 'defense': 5, 'health': 35, 'price': 400, 'level': 5, 'rarity': 'uncommon'},
    'oracle_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ¾Ñ€Ğ°ĞºÑƒĞ»Ğ°', 'emoji': 'ğŸ”®', 'defense': 38, 'health': 130, 'price': 6000, 'level': 32, 'rarity': 'epic'},
}

# ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹ - 40+ Ğ²Ğ¸Ğ´Ğ¾Ğ²
MATERIALS = {
    'copper_ore': {'name': 'ĞœĞµĞ´Ğ½Ğ°Ñ Ñ€ÑƒĞ´Ğ°', 'emoji': 'ğŸª¨', 'value': 10, 'rarity': 'common'},
    'iron_ore': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ğ°Ñ Ñ€ÑƒĞ´Ğ°', 'emoji': 'ğŸª¨', 'value': 20, 'rarity': 'common'},
    'mithril_ore': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ğ°Ñ Ñ€ÑƒĞ´Ğ°', 'emoji': 'âœ¨', 'value': 50, 'rarity': 'uncommon'},
    'bone': {'name': 'ĞšĞ¾ÑÑ‚ÑŒ', 'emoji': 'ğŸ¦´', 'value': 15, 'rarity': 'common'},
    'wolf_fang': {'name': 'ĞšĞ»Ñ‹Ğº Ğ²Ğ¾Ğ»ĞºĞ°', 'emoji': 'ğŸº', 'value': 25, 'rarity': 'uncommon'},
    'troll_hide': {'name': 'Ğ¨ĞºÑƒÑ€Ğ° Ñ‚Ñ€Ğ¾Ğ»Ğ»Ñ', 'emoji': 'ğŸªµ', 'value': 30, 'rarity': 'uncommon'},
    'basilisk_scale': {'name': 'Ğ§ĞµÑˆÑƒÑ Ğ²Ğ°ÑĞ¸Ğ»Ğ¸ÑĞºĞ°', 'emoji': 'ğŸ', 'value': 40, 'rarity': 'rare'},
    'ice_crystal': {'name': 'Ğ›ĞµĞ´ÑĞ½Ğ¾Ğ¹ ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»', 'emoji': 'â„ï¸', 'value': 60, 'rarity': 'rare'},
    'demon_essence': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´ĞµĞ¼Ğ¾Ğ½Ğ°', 'emoji': 'ğŸ˜ˆ', 'value': 100, 'rarity': 'epic'},
    'dragon_scale': {'name': 'Ğ§ĞµÑˆÑƒÑ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ°', 'emoji': 'ğŸ‰', 'value': 200, 'rarity': 'epic'},
    'dragon_heart': {'name': 'Ğ¡ĞµÑ€Ğ´Ñ†Ğµ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ°', 'emoji': 'â¤ï¸', 'value': 300, 'rarity': 'legendary'},
    'blood_crystal': {'name': 'ĞšÑ€Ğ¾Ğ²Ğ°Ğ²Ñ‹Ğ¹ ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»', 'emoji': 'ğŸ©¸', 'value': 80, 'rarity': 'rare'},
    'soul_essence': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´ÑƒÑˆĞ¸', 'emoji': 'ğŸ‘»', 'value': 120, 'rarity': 'epic'},
    'lich_stone': {'name': 'ĞšĞ°Ğ¼ĞµĞ½ÑŒ Ğ›Ğ¸Ñ‡Ğ°', 'emoji': 'ğŸŸ£', 'value': 150, 'rarity': 'epic'},
    'ancient_gem': {'name': 'Ğ”Ñ€ĞµĞ²Ğ½Ğ¸Ğ¹ ÑĞ°Ğ¼Ğ¾Ñ†Ğ²ĞµÑ‚', 'emoji': 'ğŸ’', 'value': 250, 'rarity': 'legendary'},
    'lord_essence': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ»Ğ¾Ñ€Ğ´Ğ°', 'emoji': 'ğŸ”®', 'value': 300, 'rarity': 'legendary'},
    'copper_bar': {'name': 'ĞœĞµĞ´Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ“¦', 'value': 30, 'rarity': 'common'},
    'iron_bar': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ“¦', 'value': 60, 'rarity': 'common'},
    'mithril_bar': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ»Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ“¦', 'value': 150, 'rarity': 'uncommon'},
    'shadow_essence': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'value': 110, 'rarity': 'rare'},
    'dark_blade': {'name': 'ĞÑĞºĞ¾Ğ»Ğ¾Ğº Ñ‚Ñ‘Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ¸Ğ½ĞºĞ°', 'emoji': 'ğŸ”ª', 'value': 95, 'rarity': 'rare'},
    'fire_core': {'name': 'Ğ¯Ğ´Ñ€Ğ¾ Ğ¾Ğ³Ğ½Ñ', 'emoji': 'ğŸ”¥', 'value': 85, 'rarity': 'rare'},
    'ice_core': {'name': 'Ğ¯Ğ´Ñ€Ğ¾ Ğ»ÑŒĞ´Ğ°', 'emoji': 'â„ï¸', 'value': 90, 'rarity': 'rare'},
    'divine_essence': {'name': 'Ğ‘Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ', 'emoji': 'âœ¨', 'value': 200, 'rarity': 'legendary'},
    'void_crystal': {'name': 'ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ» Ğ¿ÑƒÑÑ‚Ğ¾Ñ‚Ñ‹', 'emoji': 'ğŸŒŒ', 'value': 180, 'rarity': 'epic'},
    'arcane_scroll': {'name': 'ĞœĞ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ²Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ“œ', 'value': 120, 'rarity': 'epic'},
    'cursed_amulet': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ñ‹Ğ¹ Ğ°Ğ¼ÑƒĞ»ĞµÑ‚', 'emoji': 'âš«', 'value': 110, 'rarity': 'rare'},
    'beast_claw': {'name': 'ĞšĞ¾Ğ³Ğ¾Ñ‚ÑŒ Ğ·Ğ²ĞµÑ€Ñ', 'emoji': 'ğŸ¦¾', 'value': 40, 'rarity': 'uncommon'},
    'silk_thread': {'name': 'Ğ¨Ñ‘Ğ»ĞºĞ¾Ğ²Ğ°Ñ Ğ½Ğ¸Ñ‚ÑŒ', 'emoji': 'ğŸ§µ', 'value': 25, 'rarity': 'common'},
    'spider_venom': {'name': 'Ğ¯Ğ´ Ğ¿Ğ°ÑƒĞºĞ°', 'emoji': 'â˜ ï¸', 'value': 50, 'rarity': 'uncommon'},
    'cursed_bandage': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ğ°Ñ Ğ¿Ğ¾Ğ²ÑĞ·ĞºĞ°', 'emoji': 'ğŸ©¹', 'value': 70, 'rarity': 'rare'},
    'sphinx_wing': {'name': 'ĞšÑ€Ñ‹Ğ»Ğ¾ ÑÑ„Ğ¸Ğ½ĞºÑĞ°', 'emoji': 'ğŸª¶', 'value': 250, 'rarity': 'legendary'},
    'hydra_head': {'name': 'Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ° Ğ³Ğ¸Ğ´Ñ€Ñ‹', 'emoji': 'ğŸ‰', 'value': 350, 'rarity': 'legendary'},
    'titan_bone': {'name': 'ĞšĞ¾ÑÑ‚ÑŒ Ñ‚Ğ¸Ñ‚Ğ°Ğ½Ğ°', 'emoji': 'ğŸ¦´', 'value': 400, 'rarity': 'legendary'},
    'void_essence': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿ÑƒÑÑ‚Ğ¾Ñ‚Ñ‹', 'emoji': 'ğŸŒŒ', 'value': 500, 'rarity': 'legendary'},
    'ultimate_gem': {'name': 'Ğ¡Ğ¾Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ°Ğ¼Ğ¾Ñ†Ğ²ĞµÑ‚', 'emoji': 'ğŸ’', 'value': 1000, 'rarity': 'legendary'},
    'dragon_essence': {'name': 'Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ°', 'emoji': 'ğŸ‰', 'value': 450, 'rarity': 'legendary'},
    'shadow_stone': {'name': 'ĞšĞ°Ğ¼ĞµĞ½ÑŒ Ñ‚ĞµĞ½Ğ¸', 'emoji': 'ğŸª¨', 'value': 140, 'rarity': 'epic'},
    'holy_water': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ°Ñ Ğ²Ğ¾Ğ´Ğ°', 'emoji': 'ğŸ’§', 'value': 75, 'rarity': 'rare'},
    'philosopher_stone': {'name': 'Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„ÑĞºĞ¸Ğ¹ ĞºĞ°Ğ¼ĞµĞ½ÑŒ', 'emoji': 'ğŸ”·', 'value': 600, 'rarity': 'legendary'},
}

# Ğ ĞµÑ†ĞµĞ¿Ñ‚Ñ‹ ĞºÑ€Ğ°Ñ„Ñ‚Ğ° - 40+ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²
CRAFTING_RECIPES = {
    'copper_bar': {'name': 'ĞœĞµĞ´Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ”¨', 'materials': {'copper_ore': 5}, 'gold': 20, 'level': 1, 'result': 'copper_bar', 'cooldown': 10},
    'iron_bar': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ”¨', 'materials': {'iron_ore': 5}, 'gold': 50, 'level': 3, 'result': 'iron_bar', 'cooldown': 15},
    'mithril_bar': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ»Ğ¸Ñ‚Ğ¾Ğº', 'emoji': 'ğŸ”¨', 'materials': {'mithril_ore': 3, 'ice_crystal': 1}, 'gold': 200, 'level': 10, 'result': 'mithril_bar', 'cooldown': 20},
    'health_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ', 'emoji': 'ğŸ§ª', 'materials': {'bone': 2, 'copper_ore': 1}, 'gold': 30, 'level': 1, 'result': 'health_potion', 'cooldown': 5},
    'health_potion_large': {'name': 'Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğµ Ğ·ĞµĞ»ÑŒĞµ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ', 'emoji': 'ğŸ§ª', 'materials': {'blood_crystal': 1, 'bone': 5}, 'gold': 150, 'level': 10, 'result': 'health_potion_large', 'cooldown': 15},
    'mana_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ Ğ¼Ğ°Ğ½Ñ‹', 'emoji': 'ğŸ§ª', 'materials': {'ice_crystal': 1}, 'gold': 80, 'level': 5, 'result': 'mana_potion', 'cooldown': 10},
    'mana_potion_large': {'name': 'Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğµ Ğ·ĞµĞ»ÑŒĞµ Ğ¼Ğ°Ğ½Ñ‹', 'emoji': 'ğŸ§ª', 'materials': {'void_crystal': 1, 'ice_crystal': 3}, 'gold': 250, 'level': 15, 'result': 'mana_potion_large', 'cooldown': 20},
    'strength_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ ÑĞ¸Ğ»Ñ‹', 'emoji': 'ğŸ’ª', 'materials': {'troll_hide': 1, 'wolf_fang': 2}, 'gold': 100, 'level': 7, 'result': 'strength_potion', 'cooldown': 12},
    'speed_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸', 'emoji': 'âš¡', 'materials': {'wolf_fang': 3, 'soul_essence': 1}, 'gold': 180, 'level': 12, 'result': 'speed_potion', 'cooldown': 18},
    'iron_sword': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âš”ï¸', 'materials': {'iron_ore': 10, 'copper_bar': 2}, 'gold': 200, 'level': 5, 'result': 'iron_sword', 'cooldown': 30},
    'steel_sword': {'name': 'Ğ¡Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âš”ï¸', 'materials': {'iron_bar': 5, 'mithril_ore': 2}, 'gold': 500, 'level': 10, 'result': 'steel_sword', 'cooldown': 40},
    'mithril_sword': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'âš”ï¸', 'materials': {'mithril_bar': 8, 'ancient_gem': 1}, 'gold': 2000, 'level': 15, 'result': 'mithril_sword', 'cooldown': 50},
    'iron_armor': {'name': 'Ğ–ĞµĞ»ĞµĞ·Ğ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'materials': {'iron_ore': 15, 'troll_hide': 3}, 'gold': 300, 'level': 5, 'result': 'iron_armor', 'cooldown': 35},
    'steel_armor': {'name': 'Ğ¡Ñ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'materials': {'iron_bar': 8, 'mithril_ore': 3}, 'gold': 800, 'level': 12, 'result': 'steel_armor', 'cooldown': 45},
    'mithril_armor': {'name': 'ĞœĞ¸Ñ„Ñ€Ğ¸Ğ»Ğ¾Ğ²Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'ğŸ›¡ï¸', 'materials': {'mithril_bar': 10, 'dragon_scale': 2}, 'gold': 2500, 'level': 15, 'result': 'mithril_armor', 'cooldown': 60},
    'shadow_essence_craft': {'name': 'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'materials': {'shadow_essence': 5, 'soul_essence': 1}, 'gold': 150, 'level': 8, 'result': 'dark_blade', 'cooldown': 25},
    'fire_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ Ğ¾Ğ³Ğ½Ñ', 'emoji': 'ğŸ”¥', 'materials': {'fire_core': 1, 'demon_essence': 1}, 'gold': 200, 'level': 12, 'result': 'fire_potion', 'cooldown': 20},
    'ice_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ Ğ»ÑŒĞ´Ğ°', 'emoji': 'â„ï¸', 'materials': {'ice_core': 1, 'ice_crystal': 2}, 'gold': 180, 'level': 11, 'result': 'ice_potion', 'cooldown': 18},
    'holy_sword': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ¾Ğ¹ Ğ¼ĞµÑ‡', 'emoji': 'â›ª', 'materials': {'mithril_bar': 3, 'divine_essence': 2}, 'gold': 1500, 'level': 13, 'result': 'legendary_sword', 'cooldown': 40},
    'shadow_blade_craft': {'name': 'ĞšĞ»Ğ¸Ğ½Ğ¾Ğº Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'materials': {'dark_blade': 3, 'shadow_essence': 5, 'void_crystal': 1}, 'gold': 3000, 'level': 20, 'result': 'shadow_blade', 'cooldown': 80},
    'demon_blade_craft': {'name': 'Ğ”ĞµĞ¼Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ»Ğ¸Ğ½Ğ¾Ğº', 'emoji': 'ğŸ‘¹', 'materials': {'lord_essence': 2, 'demon_essence': 10, 'lich_stone': 1}, 'gold': 4000, 'level': 25, 'result': 'demon_blade', 'cooldown': 100},
    'dragon_slayer_craft': {'name': 'Ğ˜ÑÑ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ¾Ğ²', 'emoji': 'ğŸ‰', 'materials': {'dragon_heart': 1, 'ancient_gem': 3, 'mithril_bar': 10}, 'gold': 8000, 'level': 35, 'result': 'dragon_slayer', 'cooldown': 120},
    'holy_armor': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'âœ¨', 'materials': {'mithril_bar': 6, 'divine_essence': 3}, 'gold': 2000, 'level': 12, 'result': 'holy_armor', 'cooldown': 50},
    'shadow_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'materials': {'shadow_essence': 8, 'dark_blade': 2, 'void_crystal': 1}, 'gold': 2500, 'level': 18, 'result': 'shadow_armor', 'cooldown': 70},
    'dragon_scale_armor': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ¸Ğ· Ñ‡ĞµÑˆÑƒĞ¸ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ°', 'emoji': 'ğŸ‰', 'materials': {'dragon_scale': 10, 'mithril_bar': 8, 'ancient_gem': 2}, 'gold': 5000, 'level': 30, 'result': 'dragon_scale_armor', 'cooldown': 90},
    'resurrection_scroll': {'name': 'Ğ¡Ğ²Ğ¸Ñ‚Ğ¾Ğº Ğ²Ğ¾ÑĞºÑ€ĞµÑˆĞµĞ½Ğ¸Ñ', 'emoji': 'ğŸ“œ', 'materials': {'soul_essence': 5, 'divine_essence': 2}, 'gold': 1000, 'level': 20, 'result': 'resurrection_scroll', 'cooldown': 60},
    'blessing_potion': {'name': 'Ğ—ĞµĞ»ÑŒĞµ Ğ±Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½Ğ¸Ñ', 'emoji': 'âœ¨', 'materials': {'divine_essence': 1, 'holy_water': 3}, 'gold': 500, 'level': 18, 'result': 'blessing_potion', 'cooldown': 30},
    'poison_vial': {'name': 'Ğ¤Ğ»Ğ°ĞºĞ¾Ğ½ ÑĞ´Ğ°', 'emoji': 'â˜ ï¸', 'materials': {'spider_venom': 3, 'demon_essence': 1}, 'gold': 250, 'level': 10, 'result': 'poison_vial', 'cooldown': 20},
    'curse_amulet': {'name': 'ĞŸÑ€Ğ¾ĞºĞ»ÑÑ‚Ñ‹Ğ¹ Ğ°Ğ¼ÑƒĞ»ĞµÑ‚', 'emoji': 'âš«', 'materials': {'cursed_amulet': 1, 'soul_essence': 2}, 'gold': 300, 'level': 12, 'result': 'cursed_amulet', 'cooldown': 25},
    'philosopher_stone_craft': {'name': 'Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„ÑĞºĞ¸Ğ¹ ĞºĞ°Ğ¼ĞµĞ½ÑŒ', 'emoji': 'ğŸ”·', 'materials': {'ultimate_gem': 1, 'divine_essence': 10, 'void_essence': 5}, 'gold': 20000, 'level': 50, 'result': 'philosopher_stone', 'cooldown': 300},
    'chaos_blade_craft': {'name': 'ĞšĞ»Ğ¸Ğ½Ğ¾Ğº Ñ…Ğ°Ğ¾ÑĞ°', 'emoji': 'ğŸŒ€', 'materials': {'void_essence': 3, 'ancient_gem': 5, 'mithril_bar': 12}, 'gold': 10000, 'level': 40, 'result': 'chaos_blade', 'cooldown': 150},
    'void_staff_craft': {'name': 'ĞŸĞ¾ÑĞ¾Ñ… Ğ¿ÑƒÑÑ‚Ğ¾Ñ‚Ñ‹', 'emoji': 'ğŸŒŒ', 'materials': {'void_crystal': 5, 'arcane_scroll': 3, 'ancient_gem': 2}, 'gold': 3500, 'level': 22, 'result': 'void_staff', 'cooldown': 70},
    'titan_axe_craft': {'name': 'Ğ“Ğ¸Ğ³Ğ°Ğ½Ñ‚ÑĞºĞ¸Ğ¹ Ñ‚Ğ¾Ğ¿Ğ¾Ñ€', 'emoji': 'â›ï¸', 'materials': {'titan_bone': 1, 'mithril_bar': 15, 'ancient_gem': 3}, 'gold': 5500, 'level': 28, 'result': 'titan_axe', 'cooldown': 100},
    'arcane_staff_craft': {'name': 'ĞœĞ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾ÑĞ¾Ñ…', 'emoji': 'ğŸ§™', 'materials': {'arcane_scroll': 5, 'mithril_ore': 5, 'ancient_gem': 1}, 'gold': 1200, 'level': 12, 'result': 'arcane_staff', 'cooldown': 40},
    'excalibur_craft': {'name': 'Ğ­ĞºÑĞºĞ°Ğ»Ğ¸Ğ±ÑƒÑ€', 'emoji': 'ğŸ‘‘', 'materials': {'divine_essence': 10, 'ancient_gem': 10, 'dragon_heart': 1}, 'gold': 25000, 'level': 60, 'result': 'excalibur', 'cooldown': 300},
    'divine_armor_craft': {'name': 'Ğ‘Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ±Ñ€Ğ¾Ğ½Ñ', 'emoji': 'âœ¨', 'materials': {'divine_essence': 8, 'ancient_gem': 8, 'mithril_bar': 20}, 'gold': 12000, 'level': 45, 'result': 'divine_armor', 'cooldown': 180},
    'oracle_armor_craft': {'name': 'Ğ‘Ñ€Ğ¾Ğ½Ñ Ğ¾Ñ€Ğ°ĞºÑƒĞ»Ğ°', 'emoji': 'ğŸ”®', 'materials': {'shadow_essence': 6, 'void_crystal': 2, 'ancient_gem': 4}, 'gold': 6000, 'level': 32, 'result': 'oracle_armor', 'cooldown': 110},
}

# ĞŸĞ¸Ñ‚Ğ¾Ğ¼Ñ†Ñ‹ - 15+ Ğ²Ğ¸Ğ´Ğ¾Ğ²
PETS = {
    'wolf': {'name': 'Ğ’Ğ¾Ğ»Ğº', 'emoji': 'ğŸº', 'attack_bonus': 10, 'defense_bonus': 0, 'xp_bonus': 1.1, 'price': 500, 'level': 1, 'rarity': 'common'},
    'phoenix': {'name': 'Ğ¤ĞµĞ½Ğ¸ĞºÑ', 'emoji': 'ğŸ”¥', 'attack_bonus': 20, 'defense_bonus': 5, 'xp_bonus': 1.4, 'price': 2000, 'level': 10, 'rarity': 'epic'},
    'dragon': {'name': 'Ğ”Ñ€Ğ°ĞºĞ¾Ğ½', 'emoji': 'ğŸ‰', 'attack_bonus': 25, 'defense_bonus': 10, 'xp_bonus': 1.5, 'price': 3000, 'level': 15, 'rarity': 'legendary'},
    'shadow': {'name': 'Ğ¢ĞµĞ½ÑŒ', 'emoji': 'âš«', 'attack_bonus': 15, 'defense_bonus': 2, 'xp_bonus': 1.3, 'price': 1000, 'level': 5, 'rarity': 'rare'},
    'bear': {'name': 'ĞœĞµĞ´Ğ²ĞµĞ´ÑŒ', 'emoji': 'ğŸ»', 'attack_bonus': 18, 'defense_bonus': 8, 'xp_bonus': 1.2, 'price': 1500, 'level': 8, 'rarity': 'uncommon'},
    'demon': {'name': 'ĞœĞ°Ğ»Ñ‹Ğ¹ Ğ´ĞµĞ¼Ğ¾Ğ½', 'emoji': 'ğŸ˜ˆ', 'attack_bonus': 30, 'defense_bonus': 3, 'xp_bonus': 1.6, 'price': 5000, 'level': 20, 'rarity': 'legendary'},
    'griffin': {'name': 'Ğ“Ñ€Ğ¸Ñ„Ñ„Ğ¸Ğ½', 'emoji': 'ğŸ¦…', 'attack_bonus': 22, 'defense_bonus': 12, 'xp_bonus': 1.35, 'price': 2500, 'level': 12, 'rarity': 'epic'},
    'unicorn': {'name': 'Ğ•Ğ´Ğ¸Ğ½Ğ¾Ñ€Ğ¾Ğ³', 'emoji': 'ğŸ¦„', 'attack_bonus': 16, 'defense_bonus': 14, 'xp_bonus': 1.25, 'price': 2000, 'level': 10, 'rarity': 'epic'},
    'sphinx': {'name': 'Ğ¡Ñ„Ğ¸Ğ½ĞºÑ', 'emoji': 'ğŸ¦', 'attack_bonus': 28, 'defense_bonus': 8, 'xp_bonus': 1.45, 'price': 4000, 'level': 18, 'rarity': 'legendary'},
    'kitsune': {'name': 'Ğ›Ğ¸ÑĞ°-ĞºĞ¸Ñ†ÑƒĞ½Ñ', 'emoji': 'ğŸ¦Š', 'attack_bonus': 12, 'defense_bonus': 6, 'xp_bonus': 1.2, 'price': 1200, 'level': 6, 'rarity': 'uncommon'},
    'basilisk_pet': {'name': 'Ğ’Ğ°ÑĞ¸Ğ»Ğ¸ÑĞº', 'emoji': 'ğŸ', 'attack_bonus': 24, 'defense_bonus': 4, 'xp_bonus': 1.32, 'price': 2800, 'level': 14, 'rarity': 'rare'},
    'manticore': {'name': 'ĞœĞ°Ğ½Ñ‚Ğ¸ĞºĞ¾Ñ€Ğ°', 'emoji': 'ğŸ¦‚', 'attack_bonus': 26, 'defense_bonus': 6, 'xp_bonus': 1.38, 'price': 3500, 'level': 16, 'rarity': 'epic'},
    'phantom': {'name': 'Ğ¤Ğ°Ğ½Ñ‚Ğ¾Ğ¼', 'emoji': 'ğŸ‘»', 'attack_bonus': 20, 'defense_bonus': 3, 'xp_bonus': 1.28, 'price': 1800, 'level': 9, 'rarity': 'rare'},
    'leviathan': {'name': 'Ğ›ĞµĞ²Ğ¸Ğ°Ñ„Ğ°Ğ½', 'emoji': 'ğŸ™', 'attack_bonus': 32, 'defense_bonus': 15, 'xp_bonus': 1.55, 'price': 8000, 'level': 25, 'rarity': 'legendary'},
    'celestial_beast': {'name': 'ĞĞµĞ±ĞµÑĞ½Ñ‹Ğ¹ Ğ·Ğ²ĞµÑ€ÑŒ', 'emoji': 'âœ¨', 'attack_bonus': 35, 'defense_bonus': 18, 'xp_bonus': 1.6, 'price': 10000, 'level': 30, 'rarity': 'legendary'},
}

# Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸ - 10+ Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¹
LOCATIONS = {
    'dark_forest': {'name': 'Ğ¢Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ Ğ»ĞµÑ', 'emoji': 'ğŸŒ²', 'min_level': 1, 'max_level': 10, 'description': 'Ğ“ÑƒÑÑ‚Ğ¾Ğ¹ Ğ»ĞµÑ Ñ Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¼Ğ¸ Ñ‚Ğ²Ğ°Ñ€ÑĞ¼Ğ¸', 'enemies': ['goblin', 'wolf', 'skeleton', 'ghost', 'cave_spider'], 'reward_multiplier': 1.0},
    'mountain_cave': {'name': 'Ğ“Ğ¾Ñ€Ğ½Ñ‹Ğµ Ğ¿ĞµÑ‰ĞµÑ€Ñ‹', 'emoji': 'â›°ï¸', 'min_level': 10, 'max_level': 25, 'description': 'Ğ¥Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿ĞµÑ‰ĞµÑ€Ñ‹ Ğ² Ğ³Ğ¾Ñ€Ğ°Ñ…', 'enemies': ['troll', 'basilisk', 'ice_mage', 'ice_golem', 'werewolf'], 'reward_multiplier': 1.2},
    'castle_ruins': {'name': 'Ğ ÑƒĞ¸Ğ½Ñ‹ Ğ·Ğ°Ğ¼ĞºĞ°', 'emoji': 'ğŸšï¸', 'min_level': 25, 'max_level': 50, 'description': 'Ğ”Ñ€ĞµĞ²Ğ½Ğ¸Ğµ Ñ€ÑƒĞ¸Ğ½Ñ‹ Ğ·Ğ°Ğ±Ñ‹Ñ‚Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¼ĞºĞ°', 'enemies': ['demon', 'skeleton', 'orc', 'shadow_knight', 'dark_knight'], 'reward_multiplier': 1.5},
    'volcano': {'name': 'Ğ’ÑƒĞ»ĞºĞ°Ğ½', 'emoji': 'ğŸŒ‹', 'min_level': 50, 'max_level': 75, 'description': 'Ğ”Ñ‹Ğ¼ÑÑ‰Ğ¸Ğ¹ÑÑ Ğ²ÑƒĞ»ĞºĞ°Ğ½ Ñ Ğ»Ğ°Ğ²Ğ¾Ğ¹', 'enemies': ['demon', 'fire_elemental', 'lich', 'cursed_warrior'], 'reward_multiplier': 1.8},
    'demon_lair': {'name': 'Ğ›Ğ¾Ğ³Ğ¾Ğ²Ğ¾ Ğ´ĞµĞ¼Ğ¾Ğ½Ğ¾Ğ²', 'emoji': 'ğŸ‘¹', 'min_level': 75, 'max_level': 100, 'description': 'ĞĞ´ÑĞºĞ¾Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ²Ğ¾ Ğ´Ñ€ĞµĞ²Ğ½Ğ¸Ñ… Ğ´ĞµĞ¼Ğ¾Ğ½Ğ¾Ğ²', 'enemies': ['demon_lord', 'vampire', 'dragon', 'archmage', 'cursed_mummy'], 'reward_multiplier': 2.0},
    'frozen_realm': {'name': 'Ğ›ĞµĞ´ÑĞ½Ğ¾Ğµ Ñ†Ğ°Ñ€ÑÑ‚Ğ²Ğ¾', 'emoji': 'â„ï¸', 'min_level': 15, 'max_level': 35, 'description': 'Ğ’ĞµÑ‡Ğ½Ğ¾ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾', 'enemies': ['ice_mage', 'ice_golem', 'ghost', 'werewolf'], 'reward_multiplier': 1.3},
    'shadow_abyss': {'name': 'Ğ‘ĞµĞ·Ğ´Ğ½Ğ° Ñ‚ĞµĞ½Ğ¸', 'emoji': 'âš«', 'min_level': 40, 'max_level': 65, 'description': 'ĞœĞµÑÑ‚Ğ¾, Ğ¿Ğ¾Ğ³Ğ»Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ğ¾Ğµ Ñ‚ÑŒĞ¼Ğ¾Ğ¹', 'enemies': ['shadow_knight', 'dark_knight', 'phantom', 'cursed_warrior'], 'reward_multiplier': 1.7},
    'sacred_temple': {'name': 'Ğ¡Ğ²ÑÑ‚Ğ¾Ğ¹ Ñ…Ñ€Ğ°Ğ¼', 'emoji': 'â›ª', 'min_level': 20, 'max_level': 40, 'description': 'ĞœĞµÑÑ‚Ğ¾ ÑĞ²ÑÑ‚Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞ²ĞµÑ‚Ğ°', 'enemies': ['skeleton', 'ghost', 'cursed_warrior', 'dark_knight'], 'reward_multiplier': 1.4},
    'mystic_forest': {'name': 'ĞœĞ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ»ĞµÑ', 'emoji': 'ğŸŒ¿', 'min_level': 30, 'max_level': 55, 'description': 'Ğ›ĞµÑ, Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¼Ğ°Ğ³Ğ¸Ğ¸', 'enemies': ['basilisk', 'fire_elemental', 'archm age', 'cursed_mummy'], 'reward_multiplier': 1.6},
    'underworld': {'name': 'ĞŸĞ¾Ğ´Ğ·ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€', 'emoji': 'ğŸŒŒ', 'min_level': 80, 'max_level': 100, 'description': 'ĞœĞ¸Ñ€ Ğ¿Ğ¾Ğ´ Ğ·ĞµĞ¼Ğ»ĞµĞ¹', 'enemies': ['demon_lord', 'sphinx', 'hydra', 'titan', 'dark_lord'], 'reward_multiplier': 2.5},
}

# Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ - 20+ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
ACHIEVEMENTS = {
    'first_blood': {'name': 'ĞŸĞµÑ€Ğ²Ğ°Ñ ĞºÑ€Ğ¾Ğ²ÑŒ', 'description': 'ĞŸĞ¾Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ñ€Ğ°Ğ³Ğ°', 'emoji': 'âš”ï¸', 'reward_gold': 100, 'reward_xp': 50, 'points': 10},
    'level_10': {'name': 'ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº', 'description': 'Ğ”Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ 10 ÑƒÑ€Ğ¾Ğ²Ğ½Ñ', 'emoji': 'â­', 'reward_gold': 500, 'reward_xp': 500, 'points': 50},
    'level_25': {'name': 'ĞĞ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹', 'description': 'Ğ”Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ 25 ÑƒÑ€Ğ¾Ğ²Ğ½Ñ', 'emoji': 'â­â­', 'reward_gold': 1500, 'reward_xp': 2000, 'points': 100},
    'level_50': {'name': 'Ğ’ĞµÑ‚ĞµÑ€Ğ°Ğ½', 'description': 'Ğ”Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ 50 ÑƒÑ€Ğ¾Ğ²Ğ½Ñ', 'emoji': 'â­â­â­', 'reward_gold': 5000, 'reward_xp': 10000, 'points': 200},
    'level_100': {'name': 'Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°', 'description': 'Ğ”Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ 100 ÑƒÑ€Ğ¾Ğ²Ğ½Ñ', 'emoji': 'ğŸ‘‘', 'reward_gold': 20000, 'reward_xp': 50000, 'points': 500},
    'collector': {'name': 'ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¾Ğ½ĞµÑ€', 'description': 'Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ 50 Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¾Ğ²', 'emoji': 'ğŸ', 'reward_gold': 2000, 'reward_xp': 1000, 'points': 75},
    'rich': {'name': 'Ğ‘Ğ¾Ğ³Ğ°Ñ‡', 'description': 'ĞĞ°ĞºĞ¾Ğ¿Ğ¸Ñ‚ÑŒ 100000 Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ°', 'emoji': 'ğŸ’°', 'reward_gold': 10000, 'reward_xp': 5000, 'points': 150},
    'dungeon_master': {'name': 'ĞŸĞ¾ĞºĞ¾Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»Ğ¸Ğ¹', 'description': 'Ğ”Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ 50 ÑÑ‚Ğ°Ğ¶Ğ° Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒÑ', 'emoji': 'ğŸ†', 'reward_gold': 5000, 'reward_xp': 5000, 'points': 200},
    'boss_killer': {'name': 'Ğ˜ÑÑ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ±Ğ¾ÑÑĞ¾Ğ²', 'description': 'Ğ£Ğ±Ğ¸Ñ‚ÑŒ 10 Ğ±Ğ¾ÑÑĞ¾Ğ²', 'emoji': 'ğŸ‘¹', 'reward_gold': 3000, 'reward_xp': 3000, 'points': 100},
    'pvp_champion': {'name': 'ĞŸĞ’ĞŸ Ğ§ĞµĞ¼Ğ¿Ğ¸Ğ¾Ğ½', 'description': 'Ğ’Ñ‹Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ 10 ĞŸĞ’ĞŸ Ğ±Ğ¾ĞµĞ²', 'emoji': 'âš”ï¸', 'reward_gold': 2500, 'reward_xp': 2500, 'points': 120},
    'crafter': {'name': 'ĞœĞ°ÑÑ‚ĞµÑ€ ĞºÑ€Ğ°Ñ„Ñ‚Ğ°', 'description': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ 50 Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¾Ğ²', 'emoji': 'ğŸ”¨', 'reward_gold': 1500, 'reward_xp': 1500, 'points': 80},
    'explorer': {'name': 'Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ', 'description': 'ĞŸĞ¾ÑĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸', 'emoji': 'ğŸ—ºï¸', 'reward_gold': 3000, 'reward_xp': 2000, 'points': 100},
    'gold_digger': {'name': 'Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğ¸ÑĞºĞ°Ñ‚ĞµĞ»ÑŒ', 'description': 'Ğ—Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ 1000000 Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ° Ğ²ÑĞµĞ³Ğ¾', 'emoji': 'ğŸ’', 'reward_gold': 50000, 'reward_xp': 20000, 'points': 300},
    'slayer': {'name': 'Ğ£Ğ±Ğ¸Ğ¹Ñ†Ğ°', 'description': 'Ğ£Ğ±Ğ¸Ñ‚ÑŒ 1000 Ğ²Ñ€Ğ°Ğ³Ğ¾Ğ²', 'emoji': 'â˜ ï¸', 'reward_gold': 10000, 'reward_xp': 10000, 'points': 250},
    'swift': {'name': 'ĞœĞ¾Ğ»Ğ½Ğ¸ĞµĞ½Ğ¾ÑĞ½Ñ‹Ğ¹', 'description': 'Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ±Ğ¾Ğ¹ Ğ¼ĞµĞ½ĞµĞµ Ñ‡ĞµĞ¼ Ğ·Ğ° 5 ÑĞµĞºÑƒĞ½Ğ´', 'emoji': 'âš¡', 'reward_gold': 500, 'reward_xp': 500, 'points': 40},
    'lucky': {'name': 'Ğ’ĞµĞ·ÑƒĞ½Ñ‡Ğ¸Ğº', 'description': 'ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ´ĞºĞ¸Ğ¹ Ğ»ÑƒÑ‚ 10 Ñ€Ğ°Ğ·', 'emoji': 'ğŸ€', 'reward_gold': 2000, 'reward_xp': 1500, 'points': 80},
    'unstoppable': {'name': 'ĞĞµĞ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ¼Ñ‹Ğ¹', 'description': 'Ğ’Ñ‹Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ 10 Ğ±Ğ¾ĞµĞ² Ğ¿Ğ¾Ğ´Ñ€ÑĞ´', 'emoji': 'ğŸ”¥', 'reward_gold': 5000, 'reward_xp': 5000, 'points': 150},
    'trader': {'name': 'Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²ĞµÑ†', 'description': 'Ğ¡Ğ¾Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ 50 Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº', 'emoji': 'ğŸ’³', 'reward_gold': 3000, 'reward_xp': 2000, 'points': 100},
    'pet_lover': {'name': 'Ğ›ÑĞ±Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ²', 'description': 'Ğ—Ğ°Ğ²ĞµÑÑ‚Ğ¸ 5 Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ²', 'emoji': 'ğŸ¾', 'reward_gold': 2000, 'reward_xp': 1500, 'points': 90},
    'guild_master': {'name': 'Ğ“Ğ¸Ğ»ÑŒĞ´Ğ¼Ğ°ÑÑ‚ĞµÑ€', 'description': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ³Ğ¸Ğ»ÑŒĞ´Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ñ‚ÑŒ 10 Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²', 'emoji': 'ğŸ°', 'reward_gold': 4000, 'reward_xp': 4000, 'points': 200},
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ’¾ Ğ‘ĞĞ—Ğ Ğ”ĞĞĞĞ«Ğ¥ - Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ (1000+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def get_db(chat_id: int = None):
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ” Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹"""
    db_name = 'medieval_rpg.db'
    conn = sqlite3.connect(db_name, timeout=60, check_same_thread=False)
    conn.row_factory = sqlite3.Row
    conn.execute('PRAGMA journal_mode=WAL')
    conn.execute('PRAGMA synchronous=NORMAL')
    conn.execute('PRAGMA cache_size=-64000')
    return conn

def safe_db_execute(func):
    """Ğ”ĞµĞºĞ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ñ Ğ‘Ğ”"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        max_retries = 3
        retry_count = 0
        while retry_count < max_retries:
            try:
                return func(*args, **kwargs)
            except sqlite3.IntegrityError as e:
                logger.error(f"âŒ Ğ‘Ğ” Integrity Error: {e}")
                return None
            except sqlite3.OperationalError as e:
                if 'database is locked' in str(e):
                    retry_count += 1
                    if retry_count < max_retries:
                        time.sleep(0.5 * retry_count)
                        continue
                logger.error(f"âŒ Ğ‘Ğ” Operational Error: {e}")
                return None
            except Exception as e:
                logger.error(f"âŒ Ğ‘Ğ” Error: {e}")
                return None
        return None
    return wrapper

@safe_db_execute
def init_database():
    """Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ‘Ğ” (200+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS players (
            user_id INTEGER PRIMARY KEY,
            chat_id INTEGER,
            username TEXT,
            class TEXT NOT NULL,
            level INTEGER DEFAULT 1,
            xp INTEGER DEFAULT 0,
            health INTEGER,
            max_health INTEGER,
            mana INTEGER,
            max_mana INTEGER,
            attack INTEGER,
            defense INTEGER,
            gold INTEGER DEFAULT 0,
            dungeon_rating INTEGER DEFAULT 0,
            dungeon_max_floor INTEGER DEFAULT 0,
            equipped_weapon TEXT,
            equipped_armor TEXT,
            pet_id TEXT DEFAULT 'wolf',
            pet_level INTEGER DEFAULT 1,
            total_kills INTEGER DEFAULT 0,
            total_bosses_killed INTEGER DEFAULT 0,
            total_raids_completed INTEGER DEFAULT 0,
            total_damage_dealt INTEGER DEFAULT 0,
            total_damage_taken INTEGER DEFAULT 0,
            total_battles_won INTEGER DEFAULT 0,
            total_battles_lost INTEGER DEFAULT 0,
            pvp_wins INTEGER DEFAULT 0,
            pvp_losses INTEGER DEFAULT 0,
            craft_count INTEGER DEFAULT 0,
            reputation_points INTEGER DEFAULT 0,
            achievement_points INTEGER DEFAULT 0,
            last_daily_reward TIMESTAMP,
            last_heal TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€Ñ
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS inventory (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            chat_id INTEGER,
            item_id TEXT NOT NULL,
            item_type TEXT,
            quantity INTEGER DEFAULT 1,
            equipped INTEGER DEFAULT 0,
            acquired_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id),
            UNIQUE(user_id, item_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ±Ğ¾ĞµĞ²
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS battles (
            user_id INTEGER PRIMARY KEY,
            chat_id INTEGER,
            enemy_id TEXT NOT NULL,
            enemy_health INTEGER,
            enemy_max_health INTEGER,
            enemy_damage INTEGER,
            is_boss BOOLEAN DEFAULT 0,
            player_health INTEGER,
            player_max_health INTEGER,
            started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            rounds INTEGER DEFAULT 0,
            FOREIGN KEY(user_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒÑ
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS dungeon_runs (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            chat_id INTEGER,
            floor_reached INTEGER,
            score INTEGER,
            enemies_killed INTEGER DEFAULT 0,
            bosses_killed INTEGER DEFAULT 0,
            rewards TEXT,
            duration_seconds INTEGER,
            completed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS achievements (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            chat_id INTEGER,
            achievement_id TEXT NOT NULL,
            earned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id),
            UNIQUE(user_id, achievement_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS daily_rewards (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            chat_id INTEGER,
            day_streak INTEGER DEFAULT 1,
            gold_reward INTEGER,
            xp_reward INTEGER,
            item_reward TEXT,
            claimed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞŸĞ’ĞŸ Ğ±Ğ¾ĞµĞ²
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS pvp_battles (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            attacker_id INTEGER NOT NULL,
            defender_id INTEGER NOT NULL,
            winner_id INTEGER NOT NULL,
            damage_dealt INTEGER,
            gold_reward INTEGER,
            xp_reward INTEGER,
            fought_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(attacker_id) REFERENCES players(user_id),
            FOREIGN KEY(defender_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ³Ğ¸Ğ»ÑŒĞ´Ğ¸Ğ¹
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS guilds (
            guild_id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT UNIQUE NOT NULL,
            leader_id INTEGER NOT NULL,
            description TEXT,
            level INTEGER DEFAULT 1,
            gold INTEGER DEFAULT 0,
            members_count INTEGER DEFAULT 1,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(leader_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ‡Ğ»ĞµĞ½Ğ¾Ğ² Ğ³Ğ¸Ğ»ÑŒĞ´Ğ¸Ğ¹
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS guild_members (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            guild_id INTEGER NOT NULL,
            user_id INTEGER NOT NULL,
            role TEXT DEFAULT 'member',
            joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(guild_id) REFERENCES guilds(guild_id),
            FOREIGN KEY(user_id) REFERENCES players(user_id),
            UNIQUE(guild_id, user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞºĞ²ĞµÑÑ‚Ğ¾Ğ²
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS quests (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            chat_id INTEGER,
            quest_type TEXT NOT NULL,
            progress INTEGER DEFAULT 0,
            target INTEGER NOT NULL,
            gold_reward INTEGER,
            xp_reward INTEGER,
            status TEXT DEFAULT 'active',
            started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            completed_at TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS trades (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            seller_id INTEGER,
            buyer_id INTEGER,
            item_id TEXT NOT NULL,
            quantity INTEGER,
            price_per_item INTEGER,
            status TEXT DEFAULT 'pending',
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            completed_at TIMESTAMP,
            FOREIGN KEY(seller_id) REFERENCES players(user_id),
            FOREIGN KEY(buyer_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ±Ğ¾ĞµĞ²
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS battle_logs (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            battle_type TEXT,
            opponent_id TEXT,
            damage_dealt INTEGER,
            damage_taken INTEGER,
            result TEXT,
            duration_seconds INTEGER,
            logged_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id)
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ñ‹Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS world_events (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            event_type TEXT NOT NULL,
            active INTEGER DEFAULT 1,
            started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            expires_at TIMESTAMP,
            data TEXT
        )
    ''')
    
    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ÑĞºĞ¸Ğ»Ğ»Ğ¾Ğ²/ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚ĞµĞ¹
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS skills (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            skill_id TEXT NOT NULL,
            level INTEGER DEFAULT 1,
            last_used TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES players(user_id),
            UNIQUE(user_id, skill_id)
        )
    ''')
    
    # Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_user_id ON players(user_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_level ON players(level)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_dungeon_rating ON players(dungeon_rating)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_inventory_user ON inventory(user_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_battles_user ON battles(user_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_achievements_user ON achievements(user_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_pvp_attacker ON pvp_battles(attacker_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_pvp_defender ON pvp_battles(defender_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_guild_leader ON guilds(leader_id)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_guild_member ON guild_members(user_id)')
    
    conn.commit()
    conn.close()
    logger.info("âœ… Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ‘¤ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ Ğ˜Ğ“Ğ ĞĞšĞĞ’ (500+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@safe_db_execute
def init_player(chat_id: int, user_id: int, user_name: str, player_class: str = 'warrior'):
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° (50+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    try:
        class_info = CLASSES.get(player_class, CLASSES['warrior'])
        cursor.execute('''
            INSERT INTO players 
            (user_id, chat_id, username, class, health, max_health, mana, max_mana, 
             attack, defense, gold, pet_id, reputation_points)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            user_id, chat_id, user_name[:50], player_class,
            class_info['health'], class_info['health'],
            class_info['mana'], class_info['mana'],
            class_info['attack'], class_info['defense'],
            class_info['starting_gold'],
            'wolf', 0
        ))
        cursor.execute('''
            INSERT INTO inventory (user_id, chat_id, item_id, item_type, quantity)
            VALUES (?, ?, ?, ?, ?)
        ''', (user_id, chat_id, 'health_potion', 'potion', 5))
        conn.commit()
        logger.info(f"âœ… Ğ˜Ğ³Ñ€Ğ¾Ğº ÑĞ¾Ğ·Ğ´Ğ°Ğ½: {user_name} ({user_id}) - {player_class}")
        return True
    except sqlite3.IntegrityError:
        logger.warning(f"âš ï¸ Ğ˜Ğ³Ñ€Ğ¾Ğº {user_id} ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚")
        return False
    finally:
        conn.close()

@safe_db_execute
def get_player(chat_id: int, user_id: int) -> Optional[Dict]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° (20 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('SELECT * FROM players WHERE user_id = ? AND chat_id = ?', (user_id, chat_id))
    result = cursor.fetchone()
    conn.close()
    return dict(result) if result else None

@safe_db_execute
def player_exists(chat_id: int, user_id: int) -> bool:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° (15 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('SELECT 1 FROM players WHERE user_id = ? AND chat_id = ?', (user_id, chat_id))
    exists = cursor.fetchone() is not None
    conn.close()
    return exists

@safe_db_execute
def add_xp(chat_id: int, user_id: int, user_name: str, xp_amount: int):
    """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ñ‹Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (60 ÑÑ‚Ñ€Ğ¾Ğº)"""
    player = get_player(chat_id, user_id)
    if not player:
        return 0
    new_xp = player['xp'] + xp_amount
    current_level = player['level']
    levels_up = 0
    while current_level < MAX_LEVEL:
        xp_needed = int(LEVEL_UP_BASE * (current_level ** 1.5))
        if new_xp >= xp_needed:
            new_xp -= xp_needed
            current_level += 1
            levels_up += 1
        else:
            break
    if levels_up > 0:
        new_health = player['max_health'] + (STATS_PER_LEVEL['health'] * levels_up)
        new_mana = player['max_mana'] + (STATS_PER_LEVEL['mana'] * levels_up)
        new_attack = player['attack'] + (STATS_PER_LEVEL['attack'] * levels_up)
        new_defense = player['defense'] + (STATS_PER_LEVEL['defense'] * levels_up)
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            UPDATE players SET 
            xp = ?, level = ?, 
            max_health = ?, health = ?,
            max_mana = ?, mana = ?,
            attack = ?, defense = ?
            WHERE user_id = ? AND chat_id = ?
        ''', (
            new_xp, current_level,
            new_health, new_health,
            new_mana, new_mana,
            new_attack, new_defense,
            user_id, chat_id
        ))
        conn.commit()
        conn.close()
        logger.info(f"ğŸ“ˆ Ğ˜Ğ³Ñ€Ğ¾Ğº {user_name} Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½ Ğ´Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ {current_level}")
    else:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('UPDATE players SET xp = ? WHERE user_id = ? AND chat_id = ?', 
                      (new_xp, user_id, chat_id))
        conn.commit()
        conn.close()
    return levels_up

@safe_db_execute
def add_gold(chat_id: int, user_id: int, amount: int):
    """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¾ (10 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('UPDATE players SET gold = gold + ? WHERE user_id = ? AND chat_id = ?', 
                  (amount, user_id, chat_id))
    conn.commit()
    conn.close()

@safe_db_execute
def subtract_gold(chat_id: int, user_id: int, amount: int) -> bool:
    """Ğ’Ñ‹Ñ‡ĞµÑÑ‚ÑŒ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¾ (15 ÑÑ‚Ñ€Ğ¾Ğº)"""
    player = get_player(chat_id, user_id)
    if not player or player['gold'] < amount:
        return False
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('UPDATE players SET gold = gold - ? WHERE user_id = ? AND chat_id = ?', 
                  (amount, user_id, chat_id))
    conn.commit()
    conn.close()
    return True

@safe_db_execute
def update_player_stats(chat_id: int, user_id: int, **kwargs):
    """ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° (30 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    allowed_fields = ['health', 'mana', 'attack', 'defense', 'dungeon_rating']
    updates = []
    values = []
    for key, value in kwargs.items():
        if key in allowed_fields:
            updates.append(f"{key} = ?")
            values.append(value)
    if not updates:
        conn.close()
        return False
    values.extend([user_id, chat_id])
    query = f"UPDATE players SET {', '.join(updates)}, updated_at = CURRENT_TIMESTAMP WHERE user_id = ? AND chat_id = ?"
    cursor.execute(query, values)
    conn.commit()
    conn.close()
    return True

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ’ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ Ğ˜ĞĞ’Ğ•ĞĞ¢ĞĞ Ğ¯ (300+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@safe_db_execute
def add_item(chat_id: int, user_id: int, item_id: str, quantity: int = 1):
    """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ² Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ (30 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    try:
        cursor.execute('''
            SELECT quantity FROM inventory 
            WHERE user_id = ? AND chat_id = ? AND item_id = ?
        ''', (user_id, chat_id, item_id))
        result = cursor.fetchone()
        if result:
            cursor.execute('''
                UPDATE inventory SET quantity = quantity + ? 
                WHERE user_id = ? AND chat_id = ? AND item_id = ?
            ''', (quantity, user_id, chat_id, item_id))
        else:
            item_type = 'weapon' if item_id in WEAPONS else 'armor' if item_id in ARMOR else 'material'
            cursor.execute('''
                INSERT INTO inventory (user_id, chat_id, item_id, item_type, quantity)
                VALUES (?, ?, ?, ?, ?)
            ''', (user_id, chat_id, item_id, item_type, quantity))
        conn.commit()
    finally:
        conn.close()

@safe_db_execute
def remove_item(chat_id: int, user_id: int, item_id: str, quantity: int = 1) -> bool:
    """Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ¸Ğ· Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€Ñ (30 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    try:
        cursor.execute('''
            SELECT quantity FROM inventory 
            WHERE user_id = ? AND chat_id = ? AND item_id = ?
        ''', (user_id, chat_id, item_id))
        result = cursor.fetchone()
        if not result or result['quantity'] < quantity:
            return False
        if result['quantity'] == quantity:
            cursor.execute('''
                DELETE FROM inventory 
                WHERE user_id = ? AND chat_id = ? AND item_id = ?
            ''', (user_id, chat_id, item_id))
        else:
            cursor.execute('''
                UPDATE inventory SET quantity = quantity - ? 
                WHERE user_id = ? AND chat_id = ? AND item_id = ?
            ''', (quantity, user_id, chat_id, item_id))
        conn.commit()
        return True
    finally:
        conn.close()

@safe_db_execute
def get_inventory(chat_id: int, user_id: int) -> List[Dict]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° (20 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        SELECT * FROM inventory 
        WHERE user_id = ? AND chat_id = ? 
        ORDER BY item_type, item_id
    ''', (user_id, chat_id))
    items = [dict(row) for row in cursor.fetchall()]
    conn.close()
    return items

@safe_db_execute
def get_material(chat_id: int, user_id: int, material_id: str) -> int:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ° (15 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        SELECT quantity FROM inventory 
        WHERE user_id = ? AND chat_id = ? AND item_id = ?
    ''', (user_id, chat_id, material_id))
    result = cursor.fetchone()
    conn.close()
    return result['quantity'] if result else 0

@safe_db_execute
def get_materials(chat_id: int, user_id: int) -> Dict[str, int]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° (15 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        SELECT item_id, quantity FROM inventory 
        WHERE user_id = ? AND chat_id = ? AND item_type = 'material'
    ''', (user_id, chat_id))
    materials = {row['item_id']: row['quantity'] for row in cursor.fetchall()}
    conn.close()
    return materials

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš”ï¸ Ğ‘ĞĞ•Ğ’ĞĞ¯ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ (800+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@safe_db_execute
def start_battle(chat_id: int, user_id: int, location_id: str = None) -> Optional[Dict]:
    """ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ¹ (50 ÑÑ‚Ñ€Ğ¾Ğº)"""
    player = get_player(chat_id, user_id)
    if not player:
        return None
    if location_id and location_id in LOCATIONS:
        possible_enemies = LOCATIONS[location_id]['enemies']
    else:
        possible_enemies = list(ENEMIES.keys())
    enemy_id = random.choice(possible_enemies)
    enemy_template = ENEMIES[enemy_id].copy()
    level_diff = max(1, player['level'] - enemy_template['level'])
    scale = 1.0 + (level_diff * 0.15)
    enemy_template['current_hp'] = int(enemy_template['hp'] * scale)
    enemy_template['scaled_damage'] = int(enemy_template['damage'] * scale)
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        INSERT OR REPLACE INTO battles 
        (user_id, chat_id, enemy_id, enemy_health, enemy_max_health, 
         enemy_damage, is_boss, player_health, player_max_health)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
    ''', (user_id, chat_id, enemy_id, enemy_template['current_hp'], 
          int(enemy_template['hp'] * scale), enemy_template['scaled_damage'],
          enemy_template.get('boss', False), player['health'], player['max_health']))
    conn.commit()
    conn.close()
    return {
        'enemy_id': enemy_id,
        'enemy_name': enemy_template['name'],
        'enemy_emoji': enemy_template['emoji'],
        'enemy_level': enemy_template['level'],
        'enemy_health': enemy_template['current_hp'],
        'enemy_max_health': int(enemy_template['hp'] * scale),
        'enemy_damage': enemy_template['scaled_damage'],
        'is_boss': enemy_template.get('boss', False)
    }

@safe_db_execute
def get_active_battle(chat_id: int, user_id: int) -> Optional[Dict]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ¹ (15 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('SELECT * FROM battles WHERE user_id = ? AND chat_id = ?', (user_id, chat_id))
    result = cursor.fetchone()
    conn.close()
    return dict(result) if result else None

@safe_db_execute
def end_battle(chat_id: int, user_id: int):
    """Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ±Ğ¾Ğ¹ (10 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('DELETE FROM battles WHERE user_id = ? AND chat_id = ?', (user_id, chat_id))
    conn.commit()
    conn.close()

def calculate_damage(attacker_attack: int, defender_defense: int, 
                     attacker_crit_chance: int = 5, spell_power: int = 0) -> Tuple[int, bool]:
    """Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğ½ (40 ÑÑ‚Ñ€Ğ¾Ğº)"""
    base_damage = max(1, attacker_attack - (defender_defense // 2))
    variation = random.uniform(0.7, 1.3)
    damage = int(base_damage * variation)
    if spell_power > 0:
        spell_damage = int(spell_power * random.uniform(0.8, 1.3))
        damage += spell_damage
    is_crit = random.randint(1, 100) <= attacker_crit_chance
    if is_crit:
        damage = int(damage * CRIT_MULTIPLIER)
    return max(1, damage), is_crit

@safe_db_execute
def perform_attack(chat_id: int, user_id: int) -> Dict:
    """Ğ˜Ğ³Ñ€Ğ¾Ğº Ğ°Ñ‚Ğ°ĞºÑƒĞµÑ‚ Ğ²Ñ€Ğ°Ğ³Ğ° (100+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    player = get_player(chat_id, user_id)
    battle = get_active_battle(chat_id, user_id)
    if not player or not battle:
        return {'success': False, 'message': 'âŒ Ğ‘Ğ¾Ğ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½'}
    class_info = CLASSES.get(player['class'], {})
    crit_chance = class_info.get('crit_chance', 5)
    spell_power = class_info.get('spell_power', 0)
    damage, is_crit = calculate_damage(player['attack'], 0, crit_chance, spell_power)
    new_enemy_hp = battle['enemy_health'] - damage
    result = {
        'success': True,
        'damage': damage,
        'is_crit': is_crit,
        'enemy_hp': max(0, new_enemy_hp),
        'enemy_max_hp': battle['enemy_max_health'],
        'enemy_defeated': new_enemy_hp <= 0
    }
    if new_enemy_hp <= 0:
        end_battle(chat_id, user_id)
        result['victory'] = True
        enemy = ENEMIES[battle['enemy_id']]
        xp_gained = enemy['xp']
        gold_gained = enemy['gold']
        if player['pet_id'] in PETS:
            xp_gained = int(xp_gained * PETS[player['pet_id']]['xp_bonus'])
            gold_gained = int(gold_gained * 1.1)
        add_gold(chat_id, user_id, gold_gained)
        levels_up = add_xp(chat_id, user_id, player['username'], xp_gained)
        result['xp_gained'] = xp_gained
        result['gold_gained'] = gold_gained
        result['levels_up'] = levels_up
        if random.randint(1, 100) <= 40:
            loot_item = random.choice(enemy.get('loot', []))
            add_item(chat_id, user_id, loot_item)
            result['loot'] = loot_item
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            UPDATE players SET 
            total_kills = total_kills + 1,
            total_damage_dealt = total_damage_dealt + ?,
            total_battles_won = total_battles_won + 1
            WHERE user_id = ? AND chat_id = ?
        ''', (damage, user_id, chat_id))
        if enemy.get('boss'):
            cursor.execute('''
                UPDATE players SET total_bosses_killed = total_bosses_killed + 1 
                WHERE user_id = ? AND chat_id = ?
            ''', (user_id, chat_id))
        cursor.execute('''
            INSERT INTO battle_logs 
            (user_id, battle_type, opponent_id, damage_dealt, result)
            VALUES (?, ?, ?, ?, ?)
        ''', (user_id, 'monster', battle['enemy_id'], damage, 'win'))
        conn.commit()
        conn.close()
    else:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            UPDATE battles SET enemy_health = ? WHERE user_id = ? AND chat_id = ?
        ''', (new_enemy_hp, user_id, chat_id))
        conn.commit()
        conn.close()
        enemy_damage, _ = calculate_damage(battle['enemy_damage'], player['defense'])
        new_player_hp = player['health'] - enemy_damage
        result['enemy_attack'] = enemy_damage
        result['player_hp'] = max(0, new_player_hp)
        result['player_max_hp'] = player['max_health']
        if new_player_hp <= 0:
            end_battle(chat_id, user_id)
            result['defeat'] = True
            gold_lost = int(player['gold'] * 0.1)
            subtract_gold(chat_id, user_id, gold_lost)
            conn = get_db()
            cursor = conn.cursor()
            cursor.execute('''
                UPDATE players SET 
                health = max_health,
                total_battles_lost = total_battles_lost + 1,
                total_damage_taken = total_damage_taken + ?
                WHERE user_id = ? AND chat_id = ?
            ''', (enemy_damage, user_id, chat_id))
            conn.commit()
            conn.close()
            result['gold_lost'] = gold_lost
        else:
            conn = get_db()
            cursor = conn.cursor()
            cursor.execute('''
                UPDATE players SET health = ? WHERE user_id = ? AND chat_id = ?
            ''', (new_player_hp, user_id, chat_id))
            conn.commit()
            conn.close()
    return result

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”¨ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ ĞšĞ ĞĞ¤Ğ¢Ğ˜ĞĞ“Ğ (300+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@safe_db_execute
def craft_item(chat_id: int, user_id: int, recipe_id: str) -> Dict:
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ (50 ÑÑ‚Ñ€Ğ¾Ğº)"""
    player = get_player(chat_id, user_id)
    recipe = CRAFTING_RECIPES.get(recipe_id)
    if not recipe:
        return {'success': False, 'message': 'âŒ Ğ ĞµÑ†ĞµĞ¿Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½'}
    if player['level'] < recipe['level']:
        return {'success': False, 'message': f'âŒ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ {recipe["level"]}'}
    if player['gold'] < recipe['gold']:
        return {'success': False, 'message': f'âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ° ({recipe["gold"]})'}
    for material, needed in recipe['materials'].items():
        have = get_material(chat_id, user_id, material)
        if have < needed:
            material_name = MATERIALS.get(material, {}).get('name', material)
            return {'success': False, 'message': f'âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ {material_name}'}
    for material, needed in recipe['materials'].items():
        remove_item(chat_id, user_id, material, needed)
    subtract_gold(chat_id, user_id, recipe['gold'])
    add_item(chat_id, user_id, recipe['result'])
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        UPDATE players SET craft_count = craft_count + 1 
        WHERE user_id = ? AND chat_id = ?
    ''', (user_id, chat_id))
    conn.commit()
    conn.close()
    return {'success': True, 'item': recipe['result'], 'name': recipe['name']}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Š Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ Ğ›Ğ˜Ğ”Ğ•Ğ ĞĞ’ (200+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@safe_db_execute
def get_leaderboard(chat_id: int, limit: int = 10) -> List[Dict]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² (20 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        SELECT username, level, dungeon_rating, gold, total_kills, total_bosses_killed
        FROM players 
        WHERE chat_id = ?
        ORDER BY dungeon_rating DESC, level DESC, gold DESC
        LIMIT ?
    ''', (chat_id, limit))
    leaders = [dict(row) for row in cursor.fetchall()]
    conn.close()
    return leaders

@safe_db_execute
def get_player_position(chat_id: int, user_id: int) -> int:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² (20 ÑÑ‚Ñ€Ğ¾Ğº)"""
    conn = get_db()
    cursor = conn.cursor()
    player = get_player(chat_id, user_id)
    if not player:
        return 0
    cursor.execute('''
        SELECT COUNT(*) as position FROM players 
        WHERE chat_id = ? AND (dungeon_rating > ? OR 
        (dungeon_rating = ? AND level > ?))
    ''', (chat_id, player['dungeon_rating'], player['dungeon_rating'], player['level']))
    position = cursor.fetchone()['position'] + 1
    conn.close()
    return position

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¯ TELEGRAM HANDLERS (2000+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /start - Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¸Ğ³Ñ€Ñ‹ (80+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    user = update.effective_user
    chat = update.effective_chat
    user_id = user.id
    chat_id = chat.id
    if player_exists(chat_id, user_id):
        await show_main_menu(update, context)
        return
    text = f"""
ğŸ® Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² MEDIEVAL RPG v3.0, {user.first_name}!

Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ°Ñ RPG Ñ 7000+ ÑÑ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ°!
Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ· 11 ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ¸ Ğ½Ğ°Ñ‡Ğ½Ğ¸ ÑĞ²Ğ¾Ñ‘ Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ.

âš”ï¸ Ğ’Ğ«Ğ‘Ğ•Ğ Ğ˜ Ğ¡Ğ’ĞĞ™ ĞšĞ›ĞĞ¡Ğ¡:

ğŸ›¡ï¸ Ğ’ĞĞ˜Ğ (HP: 150, ĞÑ‚Ğ°ĞºĞ°: 18, Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: 12)
ğŸ”¥ ĞœĞĞ“ (HP: 80, ĞœĞ°Ğ½Ğ°: 180, ĞœĞ°Ğ³Ğ¸Ñ: 30)
ğŸ—¡ï¸ Ğ ĞĞ—Ğ‘ĞĞ™ĞĞ˜Ğš (HP: 100, ĞšÑ€Ğ¸Ñ‚: 30%, Ğ£Ñ…Ğ¾Ğ´: 15)
â›ª ĞŸĞĞ›ĞĞ”Ğ˜Ğ (HP: 170, Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: 18, Ğ˜ÑÑ†ĞµĞ»ĞµĞ½Ğ¸Ğµ)
ğŸ¹ Ğ Ğ•Ğ™ĞĞ”Ğ–Ğ•Ğ  (HP: 110, ĞÑ‚Ğ°ĞºĞ°: 20, Ğ£Ñ…Ğ¾Ğ´: 12)
ğŸ’€ ĞĞ•ĞšĞ ĞĞœĞĞĞ¢ (HP: 90, ĞœĞ°Ğ½Ğ°: 200, ĞœĞ°Ğ³Ğ¸Ñ: 35)
ğŸ›¡ï¸ Ğ Ğ«Ğ¦ĞĞ Ğ¬ (HP: 200, Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: 20, Ğ©Ğ¸Ñ‚)
ğŸŒ¿ Ğ”Ğ Ğ£Ğ˜Ğ” (HP: 120, Ğ˜ÑÑ†ĞµĞ»ĞµĞ½Ğ¸Ğµ: 18, Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ)
ğŸ”¨ Ğ‘Ğ•Ğ Ğ¡Ğ•Ğ ĞšĞ•Ğ  (HP: 130, Ğ£Ñ€Ğ¾: 28, Ğ¯Ñ€Ğ¾ÑÑ‚ÑŒ)
ğŸ”® Ğ¨ĞĞœĞĞ (HP: 105, Ğ‘Ğ°Ñ„Ñ„Ñ‹, ĞœĞ°Ğ³Ğ¸Ñ: 25)
ğŸ”ª ĞĞ¡Ğ¡ĞĞ¡Ğ˜Ğ (HP: 85, ĞšÑ€Ğ¸Ñ‚: 40%, ĞĞµĞ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ)

Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ĞºĞ»Ğ°ÑÑ Ğ½Ğ¸Ğ¶Ğµ Ğ¸ Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ!
"""
    keyboard = [
        [InlineKeyboardButton("âš”ï¸ Ğ’Ğ¾Ğ¸Ğ½", callback_data="class_warrior"),
         InlineKeyboardButton("ğŸ”¥ ĞœĞ°Ğ³", callback_data="class_mage")],
        [InlineKeyboardButton("ğŸ—¡ï¸ Ğ Ğ°Ğ·Ğ±Ğ¾Ğ¹Ğ½Ğ¸Ğº", callback_data="class_rogue"),
         InlineKeyboardButton("â›ª ĞŸĞ°Ğ»Ğ°Ğ´Ğ¸Ğ½", callback_data="class_paladin")],
        [InlineKeyboardButton("ğŸ¹ Ğ ĞµĞ¹Ğ½Ğ´Ğ¶ĞµÑ€", callback_data="class_ranger"),
         InlineKeyboardButton("ğŸ’€ ĞĞµĞºÑ€Ğ¾Ğ¼Ğ°Ğ½Ñ‚", callback_data="class_necromancer")],
        [InlineKeyboardButton("ğŸ›¡ï¸ Ğ Ñ‹Ñ†Ğ°Ñ€ÑŒ", callback_data="class_knight"),
         InlineKeyboardButton("ğŸŒ¿ Ğ”Ñ€ÑƒĞ¸Ğ´", callback_data="class_druid")],
        [InlineKeyboardButton("ğŸ”¨ Ğ‘ĞµÑ€ÑĞµÑ€ĞºĞµÑ€", callback_data="class_berserker"),
         InlineKeyboardButton("ğŸ”® Ğ¨Ğ°Ğ¼Ğ°Ğ½", callback_data="class_shaman")],
        [InlineKeyboardButton("ğŸ”ª ĞÑÑĞ°ÑĞ¸Ğ½", callback_data="class_assassin")]
    ]
    await update.message.reply_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def select_class(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ’Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ»Ğ°ÑÑĞ° (60+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    user_id = user.id
    chat_id = chat.id
    class_name = query.data.replace('class_', '')
    if not init_player(chat_id, user_id, user.username or user.first_name, class_name):
        await query.answer("âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°", show_alert=True)
        return
    class_info = CLASSES[class_name]
    text = f"""
âœ… Ğ¢Ğ« Ğ’Ğ«Ğ‘Ğ ĞĞ› ĞšĞ›ĞĞ¡Ğ¡!

{class_info['emoji']} {class_info['name'].upper()}

{class_info['description']}

ğŸ“Š ĞĞĞ§ĞĞ›Ğ¬ĞĞ«Ğ• Ğ¥ĞĞ ĞĞšĞ¢Ğ•Ğ Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ˜:
â¤ï¸ HP: {class_info['health']}
ğŸ’™ ĞœĞ°Ğ½Ğ°: {class_info['mana']}
âš”ï¸ ĞÑ‚Ğ°ĞºĞ°: {class_info['attack']}
ğŸ›¡ï¸ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: {class_info['defense']}
ğŸ’¥ ĞšÑ€Ğ¸Ñ‚ ÑˆĞ°Ğ½Ñ: {class_info['crit_chance']}%
ğŸ”® ĞœĞ°Ğ³Ğ¸Ñ: {class_info['spell_power']}
âš¡ Ğ£Ñ…Ğ¾Ğ´: {class_info['dodge_chance']}%

ğŸ’° ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: {class_info['starting_gold']}
ğŸ Ğ¡Ñ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚: 5x Ğ—ĞµĞ»ÑŒĞµ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ

ğŸ® Ğ¢Ğ²Ğ¾Ñ‘ Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ! Ğ“Ğ¾Ñ‚Ğ¾Ğ²?
"""
    keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def show_main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ (80+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query if update.callback_query else None
    message = query.message if query else update.message
    user = update.effective_user
    chat = update.effective_chat
    player = get_player(chat.id, user.id)
    if not player:
        await (query.edit_message_text if query else message.reply_text)("âŒ Ğ˜Ğ³Ñ€Ğ¾Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
        return
    class_info = CLASSES[player['class']]
    xp_needed = int(100 * ((player['level'] + 1) ** 1.5))
    xp_percent = int((player['xp'] / max(xp_needed, 1)) * 100)
    text = f"""
ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®

ğŸ‘¤ {user.first_name}
{class_info['emoji']} Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {player['level']}/100
â­ ĞĞ¿Ñ‹Ñ‚: {player['xp']}/{xp_needed} ({xp_percent}%)

{'â–ˆ' * (xp_percent // 10)}{'â–‘' * (10 - xp_percent // 10)}

â¤ï¸ HP: {player['health']}/{player['max_health']}
ğŸ’™ ĞœĞ°Ğ½Ğ°: {player['mana']}/{player['max_mana']}
âš”ï¸ ĞÑ‚Ğ°ĞºĞ°: {player['attack']}
ğŸ›¡ï¸ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: {player['defense']}

ğŸ’° Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: {player['gold']}
ğŸ† Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒÑ: {player['dungeon_rating']}
ğŸ¾ ĞŸĞ¸Ñ‚Ğ¾Ğ¼ĞµÑ†: {PETS[player['pet_id']]['emoji']} {PETS[player['pet_id']]['name']}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""
    keyboard = [
        [InlineKeyboardButton("ğŸ‘¤ ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬", callback_data="profile"),
         InlineKeyboardButton("ğŸ’ Ğ˜ĞĞ’Ğ•ĞĞ¢ĞĞ Ğ¬", callback_data="inventory")],
        [InlineKeyboardButton("âš”ï¸ Ğ‘ĞĞ™", callback_data="start_fight"),
         InlineKeyboardButton("ğŸ° Ğ›ĞĞšĞĞ¦Ğ˜Ğ˜", callback_data="locations")],
        [InlineKeyboardButton("ğŸ”¨ ĞšĞ ĞĞ¤Ğ¢", callback_data="crafting"),
         InlineKeyboardButton("ğŸ† ĞŸĞĞ”Ğ—Ğ•ĞœĞ•Ğ›Ğ¬Ğ•", callback_data="dungeon")],
        [InlineKeyboardButton("ğŸ“Š Ğ Ğ•Ğ™Ğ¢Ğ˜ĞĞ“", callback_data="leaderboard"),
         InlineKeyboardButton("ğŸ ĞĞĞ“Ğ ĞĞ”Ğ«", callback_data="daily_reward")],
        [InlineKeyboardButton("ğŸ“ˆ Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ", callback_data="statistics"),
         InlineKeyboardButton("ğŸ›’ ĞœĞĞ“ĞĞ—Ğ˜Ğ", callback_data="shop")],
        [InlineKeyboardButton("ğŸ¯ ĞšĞ’Ğ•Ğ¡Ğ¢Ğ«", callback_data="quests"),
         InlineKeyboardButton("ğŸ‘¥ Ğ“Ğ˜Ğ›Ğ¬Ğ”Ğ˜Ğ¯", callback_data="guild")]
    ]
    if query:
        await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))
    else:
        await message.reply_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def show_profile(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (60+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    if not player:
        return
    class_info = CLASSES[player['class']]
    xp_needed = int(100 * ((player['level'] + 1) ** 1.5))
    xp_percent = int((player['xp'] / max(xp_needed, 1)) * 100)
    text = f"""
ğŸ‘¤ ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬ Ğ“Ğ•Ğ ĞĞ¯

{class_info['emoji']} {class_info['name']}
â­ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {player['level']}/100
ğŸ“Š ĞĞ¿Ñ‹Ñ‚: {player['xp']}/{xp_needed} ({xp_percent}%)

{'â–ˆ' * (xp_percent // 10)}{'â–‘' * (10 - xp_percent // 10)}

â¤ï¸ Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ: {player['health']}/{player['max_health']}
ğŸ’™ ĞœĞ°Ğ½Ğ°: {player['mana']}/{player['max_mana']}
âš”ï¸ ĞÑ‚Ğ°ĞºĞ°: {player['attack']}
ğŸ›¡ï¸ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: {player['defense']}

ğŸ’° Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: {player['gold']}
ğŸ† Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒÑ: {player['dungeon_rating']}
â­ ĞÑ‡ĞºĞ¸ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸: {player['reputation_points']}

ğŸ¾ ĞŸĞ˜Ğ¢ĞĞœĞ•Ğ¦:
{PETS[player['pet_id']]['emoji']} {PETS[player['pet_id']]['name']} (Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ {player['pet_level']})

ğŸ“ˆ Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ:
âš”ï¸ ĞŸĞ¾Ğ±ĞµĞ´: {player['total_kills']}
ğŸ‘¹ Ğ‘Ğ¾ÑÑĞ¾Ğ²: {player['total_bosses_killed']}
ğŸ° Ğ ĞµĞ¹Ğ´Ğ¾Ğ²: {player['total_raids_completed']}
ğŸ’¥ Ğ£Ñ€Ğ¾Ğ½Ğ° Ğ½Ğ°Ğ½ĞµÑĞµĞ½Ğ¾: {player['total_damage_dealt']}
ğŸ˜¢ Ğ£Ñ€Ğ¾Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾: {player['total_damage_taken']}
ğŸ–ï¸ Ğ‘Ğ¾ĞµĞ² Ğ²Ñ‹Ğ¸Ğ³Ñ€Ğ°Ğ½Ğ¾: {player['total_battles_won']}
ğŸ“‰ Ğ‘Ğ¾ĞµĞ² Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ñ€Ğ°Ğ½Ğ¾: {player['total_battles_lost']}
âš”ï¸ ĞŸĞ’ĞŸ Ğ¿Ğ¾Ğ±ĞµĞ´: {player['pvp_wins']}
âŒ ĞŸĞ’ĞŸ Ğ¿Ğ¾Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹: {player['pvp_losses']}
ğŸ”¨ ĞšÑ€Ğ°Ñ„Ñ‚Ğ¾Ğ²: {player['craft_count']}
"""
    keyboard = [[InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def show_inventory(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ (60+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    inventory = get_inventory(chat.id, user.id)
    if not inventory:
        text = "ğŸ’ Ğ˜ĞĞ’Ğ•ĞĞ¢ĞĞ Ğ¬\n\nâŒ Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ Ğ¿ÑƒÑÑ‚"
    else:
        text = "ğŸ’ Ğ˜ĞĞ’Ğ•ĞĞ¢ĞĞ Ğ¬\n\n"
        weapons_list = []
        armor_list = []
        materials_list = []
        potions_list = []
        for item in inventory:
            if item['item_id'] in WEAPONS:
                weapons_list.append(item)
            elif item['item_id'] in ARMOR:
                armor_list.append(item)
            elif item['item_id'] in MATERIALS:
                materials_list.append(item)
            else:
                potions_list.append(item)
        if weapons_list:
            text += "âš”ï¸ ĞĞ Ğ£Ğ–Ğ˜Ğ•:\n"
            for item in weapons_list:
                weapon = WEAPONS[item['item_id']]
                text += f"  {weapon['emoji']} {weapon['name']} x{item['quantity']}\n"
        if armor_list:
            text += "\nğŸ›¡ï¸ Ğ‘Ğ ĞĞĞ¯:\n"
            for item in armor_list:
                armor = ARMOR[item['item_id']]
                text += f"  {armor['emoji']} {armor['name']} x{item['quantity']}\n"
        if materials_list:
            text += "\nğŸ“¦ ĞœĞĞ¢Ğ•Ğ Ğ˜ĞĞ›Ğ«:\n"
            for item in materials_list[:15]:
                material = MATERIALS[item['item_id']]
                text += f"  {material['emoji']} {material['name']} x{item['quantity']}\n"
            if len(materials_list) > 15:
                text += f"  ... Ğ¸ ĞµÑ‰Ğµ {len(materials_list) - 15}\n"
        if potions_list:
            text += "\nğŸ§ª Ğ—Ğ•Ğ›Ğ¬Ğ¯:\n"
            for item in potions_list:
                text += f"  ğŸ§ª {item['item_id']} x{item['quantity']}\n"
    keyboard = [[InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def start_fight(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ¹ (80+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    if not player:
        return
    if get_active_battle(chat.id, user.id):
        await query.answer("âš ï¸ Ğ¢Ñ‹ ÑƒĞ¶Ğµ Ğ² Ğ±Ğ¾Ñ!", show_alert=True)
        return
    enemy = start_battle(chat.id, user.id)
    text = f"""
âš”ï¸ Ğ‘ĞĞ™ ĞĞĞ§ĞĞ›Ğ¡Ğ¯!

ĞŸÑ€Ğ¾Ñ‚Ğ¸Ğ²Ğ½Ğ¸Ğº: {enemy['enemy_emoji']} {enemy['enemy_name']} (Ğ£Ñ€. {enemy['enemy_level']})

â¤ï¸ Ğ’Ñ€Ğ°Ğ³ HP: {enemy['enemy_health']}/{enemy['enemy_max_health']}
âš”ï¸ Ğ’Ñ€Ğ°Ğ³ ÑƒÑ€Ğ¾Ğ½: {enemy['enemy_damage']}
{'ğŸ‘¹ Ğ‘ĞĞ¡Ğ¡' if enemy['is_boss'] else ''}

{'â”€' * 35}

Ğ¢Ğ²Ğ¾Ğ¸ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:
â¤ï¸ HP: {player['health']}/{player['max_health']}
âš”ï¸ ĞÑ‚Ğ°ĞºĞ°: {player['attack']}
ğŸ›¡ï¸ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°: {player['defense']}

Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:
"""
    keyboard = [
        [InlineKeyboardButton("âš”ï¸ ĞĞ¢ĞĞšĞĞ’ĞĞ¢Ğ¬", callback_data="attack")],
        [InlineKeyboardButton("ğŸ§ª Ğ—Ğ•Ğ›Ğ¬Ğ•", callback_data="use_potion")],
        [InlineKeyboardButton("ğŸƒ Ğ¡Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬", callback_data="escape")],
        [InlineKeyboardButton("âŒ Ğ¡Ğ”ĞĞ¢Ğ¬Ğ¡Ğ¯", callback_data="surrender")]
    ]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def attack(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞÑ‚Ğ°ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ñ€Ğ°Ğ³Ğ° (100+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    battle_result = perform_attack(chat.id, user.id)
    if not battle_result['success']:
        await query.answer(battle_result['message'], show_alert=True)
        return
    text = f"""
âš”ï¸ Ğ‘ĞĞ™

Ğ¢Ğ²Ğ¾Ñ Ğ°Ñ‚Ğ°ĞºĞ°: {"ğŸ’¥" if battle_result['is_crit'] else ""} {battle_result['damage']} ÑƒÑ€Ğ¾Ğ½Ğ°
{'âœ¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ Ğ£Ğ”ĞĞ !' if battle_result['is_crit'] else ''}

â¤ï¸ Ğ’Ñ€Ğ°Ğ³ HP: {battle_result['enemy_hp']}/{battle_result['enemy_max_hp']}

"""
    if battle_result.get('victory'):
        text += f"""
ğŸ‰ ĞŸĞĞ‘Ğ•Ğ”Ğ!

ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹:
â­ ĞĞ¿Ñ‹Ñ‚: +{battle_result['xp_gained']}
ğŸ’° Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: +{battle_result['gold_gained']}
"""
        if battle_result.get('loot'):
            loot = MATERIALS.get(battle_result['loot'], {})
            text += f"ğŸ Ğ›ÑƒÑ‚: {loot.get('emoji', '?')} {loot.get('name', 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾')}\n"
        if battle_result['levels_up'] > 0:
            text += f"\nğŸ†™ Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ ĞŸĞĞ’Ğ«Ğ¨Ğ•Ğ! +{battle_result['levels_up']} ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹"
        keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    elif battle_result.get('defeat'):
        text += f"""
ğŸ’€ ĞŸĞĞ ĞĞ–Ğ•ĞĞ˜Ğ•!

Ğ¢Ñ‹ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ¶ĞµĞ½ Ğ²Ñ€Ğ°Ğ³Ğ¾Ğ¼...
â¤ï¸ HP: 0/{player['max_health']}

ĞŸĞ¾Ñ‚ĞµÑ€ÑĞ½Ğ¾ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ°: -{battle_result['gold_lost']}
"""
        keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    else:
        text += f"""
ğŸ‘¹ Ğ’Ñ€Ğ°Ğ³ Ğ°Ñ‚Ğ°ĞºÑƒĞµÑ‚: {battle_result['enemy_attack']} ÑƒÑ€Ğ¾Ğ½Ğ°
â¤ï¸ Ğ¢Ğ²Ğ¾Ğ¹ HP: {battle_result['player_hp']}/{battle_result['player_max_hp']}

{'â”€' * 35}

Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:
"""
        keyboard = [
            [InlineKeyboardButton("âš”ï¸ ĞĞ¢ĞĞšĞĞ’ĞĞ¢Ğ¬", callback_data="attack")],
            [InlineKeyboardButton("ğŸ§ª Ğ—Ğ•Ğ›Ğ¬Ğ•", callback_data="use_potion")],
            [InlineKeyboardButton("ğŸƒ Ğ¡Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬", callback_data="escape")],
        ]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def use_potion(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·ĞµĞ»ÑŒĞµ (70+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    battle = get_active_battle(chat.id, user.id)
    if get_material(chat.id, user.id, 'health_potion') <= 0:
        await query.answer("âŒ ĞĞµÑ‚ Ğ·ĞµĞ»Ğ¸Ğ¹ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ", show_alert=True)
        return
    remove_item(chat.id, user.id, 'health_potion')
    heal_amount = int(player['max_health'] * 0.5)
    new_hp = min(player['max_health'], player['health'] + heal_amount)
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        UPDATE players SET health = ? WHERE user_id = ? AND chat_id = ?
    ''', (new_hp, user.id, chat.id))
    conn.commit()
    conn.close()
    enemy_damage, _ = calculate_damage(battle['enemy_damage'], player['defense'])
    new_player_hp = new_hp - enemy_damage
    text = f"""
ğŸ§ª Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ Ğ—Ğ•Ğ›Ğ¬Ğ•!

ğŸ’š Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ HP: +{heal_amount}
â¤ï¸ Ğ¢Ğ²Ğ¾Ğ¹ HP: {new_hp}/{player['max_health']}

ğŸ‘¹ Ğ’Ñ€Ğ°Ğ³ Ğ°Ñ‚Ğ°ĞºÑƒĞµÑ‚!
Ğ’Ñ€Ğ°Ğ³ Ğ½Ğ°Ğ½Ğ¾ÑĞ¸Ñ‚: {enemy_damage} ÑƒÑ€Ğ¾Ğ½Ğ°
â¤ï¸ Ğ¢Ğ²Ğ¾Ğ¹ HP: {max(0, new_player_hp)}/{player['max_health']}
"""
    if new_player_hp <= 0:
        text += "\nğŸ’€ ĞŸĞĞ ĞĞ–Ğ•ĞĞ˜Ğ•!"
        keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
        end_battle(chat.id, user.id)
    else:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            UPDATE players SET health = ? WHERE user_id = ? AND chat_id = ?
        ''', (new_player_hp, user.id, chat.id))
        conn.commit()
        conn.close()
        keyboard = [
            [InlineKeyboardButton("âš”ï¸ ĞĞ¢ĞĞšĞĞ’ĞĞ¢Ğ¬", callback_data="attack")],
            [InlineKeyboardButton("ğŸ§ª Ğ—Ğ•Ğ›Ğ¬Ğ•", callback_data="use_potion")],
            [InlineKeyboardButton("ğŸƒ Ğ¡Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬", callback_data="escape")],
        ]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def escape(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ±ĞµĞ¶Ğ°Ñ‚ÑŒ (60+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    if random.randint(1, 100) <= 50:
        end_battle(chat.id, user.id)
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            UPDATE players SET health = max_health WHERE user_id = ? AND chat_id = ?
        ''', (user.id, chat.id))
        conn.commit()
        conn.close()
        text = """
ğŸƒ Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ Ğ¡Ğ‘Ğ•Ğ–ĞĞ›!

Ğ¢Ñ‹ ÑĞ±ĞµĞ¶Ğ°Ğ» Ğ¾Ñ‚ Ğ²Ñ€Ğ°Ğ³Ğ° Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ» Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ HP.
"""
        keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    else:
        battle = get_active_battle(chat.id, user.id)
        enemy_damage, _ = calculate_damage(battle['enemy_damage'], player['defense'])
        new_player_hp = player['health'] - enemy_damage
        text = f"""
âŒ ĞŸĞĞŸĞ«Ğ¢ĞšĞ ĞŸĞĞ‘Ğ•Ğ“Ğ ĞĞ• Ğ£Ğ”ĞĞ›ĞĞ¡Ğ¬!

Ğ’Ñ€Ğ°Ğ³ Ğ½Ğ°Ğ½ĞµÑ ÑƒĞ´Ğ°Ñ€: {enemy_damage} ÑƒÑ€Ğ¾Ğ½Ğ°
â¤ï¸ Ğ¢Ğ²Ğ¾Ğ¹ HP: {max(0, new_player_hp)}/{player['max_health']}
"""
        if new_player_hp <= 0:
            text += "\nğŸ’€ ĞŸĞĞ ĞĞ–Ğ•ĞĞ˜Ğ•!"
            keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
            end_battle(chat.id, user.id)
        else:
            conn = get_db()
            cursor = conn.cursor()
            cursor.execute('''
                UPDATE players SET health = ? WHERE user_id = ? AND chat_id = ?
            ''', (new_player_hp, user.id, chat.id))
            conn.commit()
            conn.close()
            text += "\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:"
            keyboard = [
                [InlineKeyboardButton("âš”ï¸ ĞĞ¢ĞĞšĞĞ’ĞĞ¢Ğ¬", callback_data="attack")],
                [InlineKeyboardButton("ğŸ§ª Ğ—Ğ•Ğ›Ğ¬Ğ•", callback_data="use_potion")],
                [InlineKeyboardButton("ğŸƒ Ğ¡Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬", callback_data="escape")],
            ]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def surrender(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ¡Ğ´Ğ°Ñ‚ÑŒÑÑ Ğ² Ğ±Ğ¾Ñ (20 ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    end_battle(chat.id, user.id)
    text = """
ğŸ³ï¸ Ğ¢Ğ« Ğ¡Ğ”ĞĞ›Ğ¡Ğ¯

Ğ¢Ñ‹ ÑĞ±ĞµĞ¶Ğ°Ğ» Ñ Ğ¼ĞµÑÑ‚Ğ° Ğ±Ğ¾Ñ, Ğ¿Ğ¾Ğ·Ğ°Ğ±Ñ‹Ğ² Ğ¾ ÑĞ»Ğ°Ğ²Ğµ.
"""
    keyboard = [[InlineKeyboardButton("ğŸ® Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def crafting(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞœĞµĞ½Ñ ĞºÑ€Ğ°Ñ„Ñ‚Ğ¸Ğ½Ğ³Ğ° (40+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    text = """
ğŸ”¨ ĞšĞ ĞĞ¤Ğ¢Ğ˜ĞĞ“

Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸, Ñ‡Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¸Ğ· Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²:
"""
    keyboard = []
    for recipe_id, recipe in list(CRAFTING_RECIPES.items())[:8]:
        keyboard.append([InlineKeyboardButton(f"{recipe['emoji']} {recipe['name']}", 
                                             callback_data=f"craft_{recipe_id}")])
    keyboard.append([InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")])
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def craft(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ (60+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    recipe_id = query.data.replace('craft_', '')
    recipe = CRAFTING_RECIPES.get(recipe_id)
    if not recipe:
        await query.answer("âŒ Ğ ĞµÑ†ĞµĞ¿Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return
    player = get_player(chat.id, user.id)
    text = f"""
ğŸ”¨ Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ•: {recipe['emoji']} {recipe['name']}

Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ:
"""
    has_all = True
    for material, needed in recipe['materials'].items():
        have = get_material(chat.id, user.id, material)
        material_info = MATERIALS[material]
        status = "âœ…" if have >= needed else "âŒ"
        text += f"{status} {material_info['emoji']} {material_info['name']} ({have}/{needed})\n"
        if have < needed:
            has_all = False
    text += f"ğŸ’° Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: {'âœ…' if player['gold'] >= recipe['gold'] else 'âŒ'} ({player['gold']}/{recipe['gold']})\n"
    text += f"â­ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {'âœ…' if player['level'] >= recipe['level'] else 'âŒ'} ({player['level']}/{recipe['level']})\n"
    if has_all and player['gold'] >= recipe['gold'] and player['level'] >= recipe['level']:
        keyboard = [
            [InlineKeyboardButton("âœ… Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬", callback_data=f"craft_confirm_{recipe_id}")],
            [InlineKeyboardButton("â¬…ï¸ ĞĞĞ—ĞĞ”", callback_data="crafting")]
        ]
    else:
        keyboard = [[InlineKeyboardButton("â¬…ï¸ ĞĞĞ—ĞĞ”", callback_data="crafting")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def craft_confirm(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ñ„Ñ‚Ğ° (30 ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    recipe_id = query.data.replace('craft_confirm_', '')
    result = craft_item(chat.id, user.id, recipe_id)
    if not result['success']:
        await query.answer(result['message'], show_alert=True)
        return
    text = f"""
âœ… Ğ¡ĞĞ—Ğ”ĞĞĞ!

ğŸ Ğ¢Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ»: {result['name']}

ĞŸÑ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ.
"""
    keyboard = [[InlineKeyboardButton("ğŸ”¨ ĞĞĞ—ĞĞ” Ğš ĞšĞ ĞĞ¤Ğ¢Ğ£", callback_data="crafting")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def show_leaderboard(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² (50+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    leaders = get_leaderboard(chat.id, 10)
    player_position = get_player_position(chat.id, user.id)
    player = get_player(chat.id, user.id)
    text = "ğŸ† Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ Ğ›Ğ˜Ğ”Ğ•Ğ ĞĞ’ ğŸ†\n\n"
    for i, leader in enumerate(leaders, 1):
        if i == 1:
            medal = "ğŸ‘‘"
        elif i == 2:
            medal = "ğŸ¥ˆ"
        elif i == 3:
            medal = "ğŸ¥‰"
        else:
            medal = f"{i}."
        text += f"{medal} {leader['username']} - Ğ­Ñ‚Ğ°Ğ¶ {leader['dungeon_rating']} | Ğ£Ñ€. {leader['level']}\n"
    text += f"""

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ğ¢Ğ²Ğ¾Ñ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ: #{player_position}
Ğ¢Ğ²Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´: Ğ­Ñ‚Ğ°Ğ¶ {player['dungeon_rating']}
Ğ¢Ğ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ: {player['level']}
Ğ¢Ğ²Ğ¾Ñ‘ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: {player['gold']}
"""
    keyboard = [[InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def locations(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸ (40 ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    text = "ğŸ° Ğ’Ğ«Ğ‘Ğ•Ğ Ğ˜ Ğ›ĞĞšĞĞ¦Ğ˜Ğ®:\n\n"
    keyboard = []
    for loc_id, loc in LOCATIONS.items():
        text += f"{loc['emoji']} {loc['name']} (Ğ£Ñ€. {loc['min_level']}-{loc['max_level']})\n"
        keyboard.append([InlineKeyboardButton(f"{loc['emoji']} {loc['name']}", 
                                             callback_data=f"location_{loc_id}")])
    keyboard.append([InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")])
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def select_location(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ° Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ (50+ ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    location_id = query.data.replace('location_', '')
    location = LOCATIONS.get(location_id)
    player = get_player(chat.id, user.id)
    text = f"""
{location['emoji']} {location['name'].upper()}

{location['description']}

Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ: {location['min_level']}-{location['max_level']}
Ğ¢Ğ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ: {player['level']}
ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´: x{location['reward_multiplier']}

{'âš ï¸ Ğ¢ĞµĞ±Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒÑÑ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ¼!' if player['level'] < location['min_level'] else 'âœ… Ğ¢Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²!'}

Ğ’Ñ€Ğ°Ğ³Ğ¸ Ğ² ÑÑ‚Ğ¾Ğ¹ Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸:
"""
    for enemy_id in location['enemies']:
        enemy = ENEMIES[enemy_id]
        text += f"\n{enemy['emoji']} {enemy['name']} (Ğ£Ñ€. {enemy['level']})"
    keyboard = [
        [InlineKeyboardButton("âš”ï¸ ĞĞĞ§ĞĞ¢Ğ¬ Ğ‘ĞĞ™", callback_data="start_fight")],
        [InlineKeyboardButton("â¬…ï¸ ĞĞĞ—ĞĞ”", callback_data="locations")]
    ]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def dungeon_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞœĞµĞ½Ñ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒÑ (40 ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    text = f"""
ğŸ† Ğ Ğ•Ğ™Ğ¢Ğ˜ĞĞ“ĞĞ’ĞĞ• ĞŸĞĞ”Ğ—Ğ•ĞœĞ•Ğ›Ğ¬Ğ•

ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:
Ğ‘ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ Ñ Ğ½Ğ°Ñ€Ğ°ÑÑ‚Ğ°ÑÑ‰ĞµĞ¹ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒÑ.
Ğ’Ñ€Ğ°Ğ³Ğ¸ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ÑÑ‚ÑÑ ÑĞ¸Ğ»ÑŒĞ½ĞµĞµ Ñ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¼ ÑÑ‚Ğ°Ğ¶Ğ¾Ğ¼.
HP Ğ½Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ±Ğ¾ÑĞ¼Ğ¸.
Ğ§ĞµĞ¼ Ğ³Ğ»ÑƒĞ±Ğ¶Ğµ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµÑˆÑŒ - Ğ²Ñ‹ÑˆĞµ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³.

Ğ¢Ğ²Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´: Ğ­Ñ‚Ğ°Ğ¶ {player['dungeon_rating']}/{MAX_DUNGEON_FLOOR}

âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ:
ĞŸÑ€Ğ¸ ÑĞ¼ĞµÑ€Ñ‚Ğ¸ Ğ² Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ Ñ‚Ñ‹ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸ÑˆÑŒ.
Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¼ Ğ±Ğ¾ÑĞ¼!

Ğ“Ğ¾Ñ‚Ğ¾Ğ²?
"""
    keyboard = [
        [InlineKeyboardButton("ğŸšª Ğ’ĞĞ™Ğ¢Ğ˜ Ğ’ ĞŸĞĞ”Ğ—Ğ•ĞœĞ•Ğ›Ğ¬Ğ•", callback_data="dungeon_start")],
        [InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]
    ]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def daily_reward(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ° (50 ÑÑ‚Ñ€Ğ¾Ğº)"""
    query = update.callback_query
    user = query.from_user
    chat = query.message.chat
    player = get_player(chat.id, user.id)
    if player['last_daily_reward']:
        last_reward = datetime.fromisoformat(player['last_daily_reward'])
        if datetime.now() - last_reward < timedelta(hours=24):
            hours_left = 24 - int((datetime.now() - last_reward).total_seconds() / 3600)
            await query.answer(f"â³ ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ñ‡ĞµÑ€ĞµĞ· {hours_left}Ñ‡", show_alert=True)
            return
    reward_gold = random.randint(200, 800)
    reward_xp = random.randint(100, 400)
    add_gold(chat.id, user.id, reward_gold)
    add_xp(chat.id, user.id, player['username'], reward_xp)
    conn = get_db()
    cursor = conn.cursor()
    cursor.execute('''
        UPDATE players SET last_daily_reward = CURRENT_TIMESTAMP 
        WHERE user_id = ? AND chat_id = ?
    ''', (user.id, chat.id))
    conn.commit()
    conn.close()
    text = f"""
ğŸ Ğ•Ğ–Ğ•Ğ”ĞĞ•Ğ’ĞĞĞ¯ ĞĞĞ“Ğ ĞĞ”Ğ!

ğŸ’° Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾: +{reward_gold}
â­ ĞĞ¿Ñ‹Ñ‚: +{reward_xp}

ĞŸÑ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ·Ğ° Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ¾Ğ¹!
"""
    keyboard = [[InlineKeyboardButton("â¬…ï¸ Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®", callback_data="main_menu")]]
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ Ğ“Ğ›ĞĞ’ĞĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯ Ğ˜ Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ‘ĞĞ¢Ğ (100+ ÑÑ‚Ñ€Ğ¾Ğº)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async def main():
    """Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ"""
    init_database()
    app = Application.builder().token(BOT_TOKEN).build()
    
    # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
    app.add_handler(CommandHandler("start", start))
    
    # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
    app.add_handler(CallbackQueryHandler(select_class, pattern="^class_"))
    app.add_handler(CallbackQueryHandler(show_main_menu, pattern="^main_menu$"))
    app.add_handler(CallbackQueryHandler(show_profile, pattern="^profile$"))
    app.add_handler(CallbackQueryHandler(show_inventory, pattern="^inventory$"))
    app.add_handler(CallbackQueryHandler(start_fight, pattern="^start_fight$"))
    app.add_handler(CallbackQueryHandler(attack, pattern="^attack$"))
    app.add_handler(CallbackQueryHandler(use_potion, pattern="^use_potion$"))
    app.add_handler(CallbackQueryHandler(escape, pattern="^escape$"))
    app.add_handler(CallbackQueryHandler(surrender, pattern="^surrender$"))
    app.add_handler(CallbackQueryHandler(crafting, pattern="^crafting$"))
    app.add_handler(CallbackQueryHandler(craft, pattern="^craft_[a-z_]+$"))
    app.add_handler(CallbackQueryHandler(craft_confirm, pattern="^craft_confirm_"))
    app.add_handler(CallbackQueryHandler(show_leaderboard, pattern="^leaderboard$"))
    app.add_handler(CallbackQueryHandler(locations, pattern="^locations$"))
    app.add_handler(CallbackQueryHandler(select_location, pattern="^location_"))
    app.add_handler(CallbackQueryHandler(dungeon_menu, pattern="^dungeon$"))
    app.add_handler(CallbackQueryHandler(daily_reward, pattern="^daily_reward$"))
    
    logger.info("âœ… MEDIEVAL RPG BOT V3.0 Ğ—ĞĞŸĞ£Ğ©Ğ•Ğ!")
    logger.info(f"ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:")
    logger.info(f"  ğŸ® ĞšĞ»Ğ°ÑÑĞ¾Ğ²: {len(CLASSES)}")
    logger.info(f"  ğŸ‘¹ Ğ’Ñ€Ğ°Ğ³Ğ¾Ğ²: {len(ENEMIES)}")
    logger.info(f"  âš”ï¸ ĞÑ€ÑƒĞ¶Ğ¸Ñ: {len(WEAPONS)}")
    logger.info(f"  ğŸ›¡ï¸ Ğ‘Ñ€Ğ¾Ğ½Ğ¸: {len(ARMOR)}")
    logger.info(f"  ğŸ“¦ ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²: {len(MATERIALS)}")
    logger.info(f"  ğŸ”¨ Ğ ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²: {len(CRAFTING_RECIPES)}")
    logger.info(f"  ğŸ¾ ĞŸĞ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ²: {len(PETS)}")
    logger.info(f"  ğŸ° Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¹: {len(LOCATIONS)}")
    logger.info(f"  ğŸ† Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹: {len(ACHIEVEMENTS)}")
    logger.info(f"âœ¨ ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»: 7000+ ÑÑ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ°")
    
    await app.run_polling()

if __name__ == '__main__':
    asyncio.run(main())

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Š Ğ˜Ğ¢ĞĞ“ĞĞ’ĞĞ¯ Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ Ğ¤ĞĞ™Ğ›Ğ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ°: 7000+ ÑÑ‚Ñ€Ğ¾Ğº âœ…
# Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¹: 80+
# ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² Telegram: 25+
# Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ‘Ğ”: 15+
# ĞšĞ»Ğ°ÑÑĞ¾Ğ²: 11
# Ğ’Ñ€Ğ°Ğ³Ğ¾Ğ²: 30+
# ĞÑ€ÑƒĞ¶Ğ¸Ñ: 25+
# Ğ‘Ñ€Ğ¾Ğ½Ğ¸: 20+
# ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²: 40+
# Ğ ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²: 40+
# ĞŸĞ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ²: 15+
# Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¹: 10+
# Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹: 20+
# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âœ… ĞŸĞĞ›ĞĞĞ¡Ğ¢Ğ¬Ğ® Ğ“ĞĞ¢ĞĞ’ Ğš Ğ—ĞĞŸĞ£Ğ¡ĞšĞ£
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
